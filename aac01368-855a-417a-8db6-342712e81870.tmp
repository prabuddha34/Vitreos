<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VITREOS — AI Medical Advisor</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700;900&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<style>
/* ── Variables ── */
:root {
  --bg:        #010a12;
  --bg-mid:    #020e1a;
  --card:      rgba(0,40,80,0.35);
  --card-h:    rgba(0,55,110,0.55);
  --border:    rgba(0,200,255,0.15);
  --borderg:   rgba(0,245,255,0.4);
  --cyan:      #00f5ff;
  --teal:      #00d4aa;
  --blue:      #0080ff;
  --green:     #00ff88;
  --red:       #ff2d55;
  --orange:    #ff8c00;
  --txt:       #e0f4ff;
  --txt2:      #7eb8d4;
  --dim:       #3a6a8a;
  --blur:      16px;
  --r:         14px;
  --tr:        0.3s cubic-bezier(.4,0,.2,1);
  --fd:        'Orbitron',monospace;
  --fb:        'Exo 2',sans-serif;
}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{scroll-behavior:smooth}
body{font-family:var(--fb);background:var(--bg);color:var(--txt);min-height:100vh;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:var(--bg-mid)}::-webkit-scrollbar-thumb{background:rgba(0,245,255,0.2);border-radius:3px}

/* ── Backgrounds ── */
#pc{position:fixed;inset:0;z-index:0;pointer-events:none;opacity:.45}
.bgr{position:fixed;inset:0;z-index:0;background:radial-gradient(ellipse 80% 60% at 20% 30%,rgba(0,100,200,.12),transparent 60%),radial-gradient(ellipse 60% 80% at 80% 70%,rgba(0,200,180,.08),transparent 60%);pointer-events:none}

/* ── Loader ── */
#ls{position:fixed;inset:0;background:var(--bg);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;transition:opacity .7s,visibility .7s}
#ls.gone{opacity:0;visibility:hidden}
.lr{width:72px;height:72px;border:2px solid var(--border);border-top-color:var(--cyan);border-radius:50%;animation:spin 1s linear infinite;box-shadow:0 0 20px rgba(0,245,255,.3);position:relative}
.lr::after{content:'⊕';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:22px;color:var(--cyan);animation:spin 1s linear infinite reverse}
.lt{font-family:var(--fd);font-size:11px;letter-spacing:4px;color:var(--cyan);text-transform:uppercase;animation:pulse 1.5s ease-in-out infinite}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes pulse{50%{opacity:.3}}

/* ── Nav ── */
nav{position:fixed;top:0;left:0;right:0;z-index:100;padding:12px 28px;display:flex;align-items:center;justify-content:space-between;background:rgba(1,10,18,.85);backdrop-filter:blur(20px);border-bottom:1px solid var(--border)}
.logo{font-family:var(--fd);font-size:18px;font-weight:900;color:var(--cyan);text-shadow:0 0 18px rgba(0,245,255,.6);letter-spacing:2px;cursor:pointer}
.logo span{color:var(--txt2);font-weight:400}
.nl{display:flex;gap:2px;list-style:none;align-items:center}
.nl button{font-family:var(--fd);font-size:9.5px;letter-spacing:1.5px;text-transform:uppercase;color:var(--txt2);background:transparent;border:1px solid transparent;padding:7px 12px;border-radius:6px;cursor:pointer;transition:var(--tr)}
.nl button:hover,.nl button.act{color:var(--cyan);background:rgba(0,245,255,.05);border-color:rgba(0,245,255,.2);text-shadow:0 0 8px rgba(0,245,255,.5)}
.nav-r{display:flex;gap:10px;align-items:center}
.tbtn{background:var(--card);border:1px solid var(--border);color:var(--txt2);padding:7px 11px;border-radius:6px;cursor:pointer;font-size:14px;transition:var(--tr)}
.tbtn:hover{border-color:var(--cyan);color:var(--cyan)}
/* Language dropdown */
.lang-wrap{position:relative}
.lang-sel{background:var(--card);border:1px solid var(--border);color:var(--txt2);padding:7px 11px;border-radius:6px;cursor:pointer;font-size:12px;font-family:var(--fd);font-size:9.5px;letter-spacing:1px;transition:var(--tr);appearance:none;-webkit-appearance:none;padding-right:24px;outline:none}
.lang-sel:hover,.lang-sel:focus{border-color:var(--cyan);color:var(--cyan)}
.lang-wrap::after{content:'▾';position:absolute;right:8px;top:50%;transform:translateY(-50%);color:var(--cyan);pointer-events:none;font-size:10px}
.ham{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:8px}
.ham span{width:22px;height:2px;background:var(--cyan);border-radius:2px;transition:var(--tr);display:block}

/* ── Pages ── */
.page{display:none;position:relative;z-index:1;padding-top:68px;min-height:100vh}
.page.active{display:block}
.wrap{max-width:1260px;margin:0 auto;padding:0 22px}

/* ── Glass Card ── */
.gc{background:var(--card);backdrop-filter:blur(var(--blur));-webkit-backdrop-filter:blur(var(--blur));border:1px solid var(--border);border-radius:var(--r);transition:var(--tr);position:relative;overflow:hidden}
.gc::before{content:'';position:absolute;inset:0;border-radius:inherit;background:linear-gradient(135deg,rgba(0,245,255,.04),transparent 60%);pointer-events:none}
.gc:hover{background:var(--card-h);border-color:var(--borderg);box-shadow:0 0 28px rgba(0,245,255,.07),0 8px 28px rgba(0,0,0,.4);transform:translateY(-2px)}

/* ── Buttons ── */
.btn{font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;padding:12px 24px;border-radius:10px;border:none;cursor:pointer;transition:var(--tr);display:inline-flex;align-items:center;gap:9px;position:relative;overflow:hidden}
.bp{background:linear-gradient(135deg,#005577,#007799);color:var(--cyan);border:1px solid var(--cyan);box-shadow:0 0 18px rgba(0,245,255,.2)}
.bp:hover{box-shadow:0 0 38px rgba(0,245,255,.5),0 0 70px rgba(0,245,255,.18);transform:translateY(-2px)}
.bs{background:transparent;color:var(--txt2);border:1px solid var(--border)}
.bs:hover{border-color:var(--teal);color:var(--teal);box-shadow:0 0 18px rgba(0,212,170,.2)}
.bv{background:linear-gradient(135deg,#004488,#006655);color:var(--teal);border:1px solid var(--teal);box-shadow:0 0 14px rgba(0,212,170,.2)}
.bv:hover{box-shadow:0 0 32px rgba(0,212,170,.5);transform:translateY(-2px)}
.ba{background:linear-gradient(135deg,#550033,#880055);color:#ff88cc;border:1px solid #ff44aa;box-shadow:0 0 14px rgba(255,68,170,.15)}
.ba:hover{box-shadow:0 0 32px rgba(255,68,170,.4);transform:translateY(-2px)}

/* ── Forms ── */
.fg{display:flex;flex-direction:column;gap:7px}
.fl{font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2)}
.fi,.fs,.fta{background:rgba(0,20,40,.6);border:1px solid var(--border);border-radius:6px;color:var(--txt);font-family:var(--fb);font-size:13.5px;padding:11px 14px;transition:var(--tr);outline:none;width:100%}
.fi::placeholder,.fta::placeholder{color:var(--dim);font-style:italic}
.fi:focus,.fs:focus,.fta:focus{border-color:var(--cyan);box-shadow:0 0 0 3px rgba(0,245,255,.1),0 0 18px rgba(0,245,255,.14);background:rgba(0,30,60,.8)}
.fs option{background:#020e1a}
.fta{resize:vertical;min-height:78px}

/* ── Section headers ── */
.stag{font-family:var(--fd);font-size:9.5px;letter-spacing:4px;text-transform:uppercase;color:var(--teal);margin-bottom:7px}
.stitle{font-family:var(--fd);font-size:clamp(22px,3.2vw,40px);font-weight:700;color:var(--txt);line-height:1.15;margin-bottom:10px}
.stitle .ac{color:var(--cyan);text-shadow:0 0 18px rgba(0,245,255,.4)}
.ssub{font-size:14px;color:var(--txt2);line-height:1.7;max-width:560px}

/* ── Badges ── */
.badge{font-family:var(--fd);font-size:8.5px;letter-spacing:1.5px;text-transform:uppercase;padding:3px 9px;border-radius:20px;font-weight:600}
.bl{background:rgba(0,255,136,.1);border:1px solid var(--green);color:var(--green)}
.bm{background:rgba(255,140,0,.1);border:1px solid var(--orange);color:var(--orange)}
.bh{background:rgba(255,45,85,.1);border:1px solid var(--red);color:var(--red)}
.bi{background:rgba(0,128,255,.1);border:1px solid var(--blue);color:var(--blue)}
.bt{background:rgba(0,212,170,.1);border:1px solid var(--teal);color:var(--teal)}

/* ── Severity Bar ── */
.sb{height:4px;background:rgba(255,255,255,.05);border-radius:2px;overflow:hidden;margin-top:7px}
.sf{height:100%;border-radius:2px;transition:width 1.1s cubic-bezier(.4,0,.2,1);box-shadow:0 0 7px currentColor}
.sf.low{background:var(--green);width:28%}
.sf.mod{background:var(--orange);width:62%}
.sf.high{background:var(--red);width:94%}

/* ── Neon Divider ── */
.nd{height:1px;background:linear-gradient(90deg,transparent,var(--borderg),transparent);margin:36px 0;position:relative}
.nd::after{content:'◆';position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);color:var(--cyan);font-size:9px;background:var(--bg);padding:0 7px;text-shadow:0 0 9px var(--cyan)}

/* ── Toast ── */
#tc{position:fixed;bottom:24px;right:24px;z-index:9000;display:flex;flex-direction:column;gap:10px}
.toast{min-width:260px;padding:12px 18px;border-radius:10px;background:var(--card);backdrop-filter:blur(16px);border:1px solid var(--border);font-size:12.5px;display:flex;align-items:center;gap:9px;box-shadow:0 8px 28px rgba(0,0,0,.4);animation:sir .3s ease}
.toast.success{border-color:var(--green)}.toast.warning{border-color:var(--orange)}.toast.error{border-color:var(--red)}
@keyframes sir{from{transform:translateX(100%);opacity:0}}
@keyframes fiu{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.fi2{opacity:0;transform:translateY(16px);animation:fiu .6s ease forwards}

/* ══════════════════════════════
   INDEX PAGE
══════════════════════════════ */
.hl{display:grid;grid-template-columns:1fr 1.1fr;gap:36px;padding:36px 0 56px;align-items:start}
.bp2{position:relative;display:flex;flex-direction:column;align-items:center;padding:36px 20px;min-height:640px}
.bpt{font-family:var(--fd);font-size:10px;letter-spacing:4px;text-transform:uppercase;color:var(--teal);margin-bottom:28px;text-align:center}
.bsw{position:relative;width:220px;flex-shrink:0}
.bsvg{width:100%;filter:drop-shadow(0 0 18px rgba(0,245,255,.4)) drop-shadow(0 0 50px rgba(0,212,170,.18));animation:bfl 5s ease-in-out infinite}
@keyframes bfl{0%,100%{transform:translateY(0)}50%{transform:translateY(-11px)}}
.scan{position:absolute;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,rgba(0,245,255,.6),transparent);animation:scm 4s ease-in-out infinite;pointer-events:none}
@keyframes scm{0%{top:10%;opacity:0}10%{opacity:1}90%{opacity:1}100%{top:90%;opacity:0}}
.hs{position:absolute;width:11px;height:11px;border-radius:50%;background:var(--cyan);box-shadow:0 0 9px var(--cyan),0 0 18px rgba(0,245,255,.4);animation:hsp 2s ease-in-out infinite;cursor:pointer;transition:var(--tr)}
.hs:hover{transform:scale(1.7);z-index:10}
.hs::after{content:attr(data-l);position:absolute;left:18px;top:50%;transform:translateY(-50%);background:var(--card);backdrop-filter:blur(8px);border:1px solid var(--borderg);border-radius:4px;padding:3px 9px;font-size:9.5px;font-family:var(--fd);letter-spacing:1px;color:var(--cyan);white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .2s}
.hs:hover::after{opacity:1}
@keyframes hsp{0%,100%{box-shadow:0 0 9px var(--cyan),0 0 18px rgba(0,245,255,.3)}50%{box-shadow:0 0 18px var(--cyan),0 0 36px rgba(0,245,255,.6)}}
.bstats{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:28px;width:100%}
.bstat{text-align:center;padding:10px 6px;border:1px solid var(--border);border-radius:6px;background:rgba(0,20,40,.4);transition:var(--tr)}
.bstat:hover{border-color:var(--borderg)}
.bsv{font-family:var(--fd);font-size:17px;font-weight:700;color:var(--cyan);text-shadow:0 0 9px rgba(0,245,255,.5)}
.bsl{font-size:8.5px;letter-spacing:1px;color:var(--dim);text-transform:uppercase;margin-top:2px}
.ap{padding:32px}
.fg2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.fw{grid-column:1/-1}
.abtn{width:100%;margin-top:20px;padding:16px;font-size:12px;justify-content:center}
.abtnl{display:none;width:16px;height:16px;border:2px solid rgba(0,245,255,.3);border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite}
.abtn.loading .abtnl{display:block}.abtn.loading .abtnt{display:none}
.rg{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:18px;margin-top:20px}
.rc{padding:22px}.rh{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.rt{font-family:var(--fd);font-size:12px;font-weight:600;color:var(--txt)}
.rd{font-size:13px;color:var(--txt2);line-height:1.6;margin:9px 0}
.re{text-align:center;padding:56px 20px;color:var(--dim)}
.rei{font-size:44px;margin-bottom:14px;opacity:.4}
.re p{font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase}

/* ══════════════════════════════
   VOICE PAGE
══════════════════════════════ */
.vl{display:grid;grid-template-columns:1fr 1fr;gap:28px;padding:36px 0}
.mc{display:flex;flex-direction:column;align-items:center;gap:20px;padding:50px 32px}
.mw{position:relative}
.mr{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:90px;height:90px;border-radius:50%;border:2px solid var(--cyan);opacity:0;pointer-events:none}
.mb.on .mr{animation:ro 1.4s ease-out infinite}
.mb.on .mr:nth-child(2){animation-delay:.5s}
.mb.on .mr:nth-child(3){animation-delay:1s}
@keyframes ro{0%{width:80px;height:80px;opacity:.8}100%{width:190px;height:190px;opacity:0}}
.mbtn{width:92px;height:92px;border-radius:50%;border:2px solid var(--cyan);background:rgba(0,245,255,.05);color:var(--cyan);font-size:34px;cursor:pointer;transition:var(--tr);position:relative;z-index:1;box-shadow:0 0 28px rgba(0,245,255,.2);display:flex;align-items:center;justify-content:center}
.mbtn:hover{background:rgba(0,245,255,.12);box-shadow:0 0 46px rgba(0,245,255,.5);transform:scale(1.05)}
.mbtn.on{background:rgba(255,45,85,.1);border-color:var(--red);color:var(--red);box-shadow:0 0 46px rgba(255,45,85,.4);animation:mpa .8s ease-in-out infinite}
@keyframes mpa{50%{transform:scale(1.07)}}
.ms{font-family:var(--fd);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--txt2);text-align:center}
.ms.on{color:var(--red);text-shadow:0 0 9px rgba(255,45,85,.5)}
.wv{display:flex;align-items:center;gap:4px;height:36px}
.wb{width:4px;background:var(--cyan);border-radius:2px;min-height:4px;box-shadow:0 0 5px var(--cyan)}
.wv.on .wb{animation:wa .8s ease-in-out infinite}
.wv.on .wb:nth-child(1){animation-delay:0s}.wv.on .wb:nth-child(2){animation-delay:.1s}.wv.on .wb:nth-child(3){animation-delay:.2s}
.wv.on .wb:nth-child(4){animation-delay:.3s}.wv.on .wb:nth-child(5){animation-delay:.4s}.wv.on .wb:nth-child(6){animation-delay:.2s}.wv.on .wb:nth-child(7){animation-delay:.1s}
@keyframes wa{0%,100%{height:4px}50%{height:30px}}
.tb{padding:18px;min-height:110px;font-size:14px;color:var(--txt2);line-height:1.7;border-radius:10px;background:rgba(0,20,40,.5);border:1px solid var(--border)}
.stag2{font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--teal);margin-bottom:14px}
.symtag{display:inline-flex;align-items:center;gap:5px;background:rgba(0,245,255,.07);border:1px solid rgba(0,245,255,.25);color:var(--cyan);font-size:11px;padding:5px 12px;border-radius:20px;margin:3px;font-family:var(--fd);letter-spacing:.5px;animation:tp .3s cubic-bezier(.34,1.56,.64,1)}
@keyframes tp{from{transform:scale(.7);opacity:0}}
/* Risk analysis verified block */
.risk-verified{background:rgba(0,212,170,.07);border:1px solid var(--teal);border-radius:10px;padding:18px 22px;display:flex;align-items:flex-start;gap:14px}
.risk-verified-icon{font-size:24px;flex-shrink:0}
.risk-verified-text{font-size:12.5px;color:var(--txt2);line-height:1.7}
.risk-verified-title{font-family:var(--fd);font-size:11px;color:var(--teal);margin-bottom:5px;letter-spacing:1px}

/* ══════════════════════════════
   ALLERGY PAGE
══════════════════════════════ */
.asb{display:flex;gap:10px;margin-bottom:28px}
.afc{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:20px}
.fch{font-family:var(--fd);font-size:9.5px;letter-spacing:1.5px;text-transform:uppercase;padding:7px 16px;border-radius:20px;border:1px solid var(--border);background:transparent;color:var(--txt2);cursor:pointer;transition:var(--tr)}
.fch:hover,.fch.act{border-color:var(--cyan);color:var(--cyan);background:rgba(0,245,255,.05)}
.atw{overflow-x:auto}
.at{width:100%;border-collapse:collapse;font-size:13px}
.at th{font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);padding:14px 18px;text-align:left;border-bottom:1px solid var(--border);background:rgba(0,20,40,.6)}
.at td{padding:12px 18px;border-bottom:1px solid rgba(0,100,150,.1);color:var(--txt);transition:background var(--tr)}
.at tr:hover td{background:rgba(0,245,255,.03)}.at tr:last-child td{border-bottom:none}
.ia{display:flex;align-items:flex-start;gap:14px;padding:14px;border-radius:10px;margin-bottom:10px;border-left:3px solid}
.ia.high{background:rgba(255,45,85,.06);border-color:var(--red)}
.ia.mod{background:rgba(255,140,0,.06);border-color:var(--orange)}
.ia.low{background:rgba(0,255,136,.05);border-color:var(--green)}
.aii{font-size:20px;flex-shrink:0}.aic{flex:1}
.ait{font-family:var(--fd);font-size:11px;font-weight:600;margin-bottom:3px;color:var(--txt)}
.aid{font-size:12.5px;color:var(--txt2);line-height:1.6}
/* Med Check */
.medcheck-wrap{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px}
.medcheck-result{padding:20px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);display:none}
.medcheck-result.visible{display:block}

/* ══════════════════════════════
   DASHBOARD PAGE
══════════════════════════════ */
.dsg{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:28px}
.dsc{padding:22px;text-align:center}
.dsi{font-size:26px;margin-bottom:10px}
.dsv{font-family:var(--fd);font-size:28px;font-weight:700;color:var(--cyan);text-shadow:0 0 14px rgba(0,245,255,.4)}
.dsl{font-size:10px;color:var(--dim);letter-spacing:1px;text-transform:uppercase;margin-top:3px}
.cr{display:grid;grid-template-columns:1.4fr 1fr;gap:20px;margin-bottom:20px}
.cc{padding:26px}.cc h3{font-family:var(--fd);font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);margin-bottom:18px}
.ccon{position:relative;height:210px}
.hi{display:flex;align-items:center;gap:14px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.3);margin-bottom:8px;transition:var(--tr)}
.hi:hover{border-color:var(--borderg);background:rgba(0,30,60,.5)}
.hd{font-family:var(--fd);font-size:9.5px;color:var(--dim);white-space:nowrap}
.hin{flex:1}.ht{font-size:13.5px;font-weight:600}.hs2{font-size:11.5px;color:var(--txt2);margin-top:2px}

/* ══════════════════════════════
   ANALYZER PAGE
══════════════════════════════ */
.analyzer-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-bottom:28px}
.analyzer-result-panel{padding:26px}
.analyzer-badge-row{display:flex;flex-wrap:wrap;gap:8px;margin:14px 0}
.analyzer-score{font-family:var(--fd);font-size:48px;font-weight:700;text-align:center;padding:20px 0;line-height:1}
.analyzer-score-label{font-family:var(--fd);font-size:9.5px;letter-spacing:3px;text-transform:uppercase;text-align:center;color:var(--dim)}
.safety-meter{width:100%;height:10px;border-radius:5px;background:rgba(255,255,255,.05);overflow:hidden;margin:18px 0}
.safety-fill{height:100%;border-radius:5px;transition:width 1.2s cubic-bezier(.4,0,.2,1);box-shadow:0 0 10px currentColor}

.cs{display:grid;grid-template-columns:repeat(auto-fill,minmax(170px,1fr));gap:12px;margin-bottom:36px}
.cp{padding:14px 18px;border-radius:10px;border:1px solid var(--border);background:transparent;color:var(--txt2);font-family:var(--fd);font-size:10px;letter-spacing:1px;cursor:pointer;transition:var(--tr);text-align:left;display:flex;align-items:center;gap:9px}
.cp:hover,.cp.act{border-color:var(--teal);color:var(--teal);background:rgba(0,212,170,.05);box-shadow:0 0 18px rgba(0,212,170,.1)}
.cpi{font-size:20px}
.fr2{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.fc2{padding:22px}.fch2{display:flex;align-items:center;gap:10px;margin-bottom:18px}
.fci{font-size:28px}.fct{font-family:var(--fd);font-size:12px;font-weight:700;color:var(--txt)}
.fcs{font-size:11px;color:var(--txt2);margin-top:2px}
.fit{display:flex;align-items:center;gap:10px;padding:9px 12px;border-radius:6px;background:rgba(0,20,40,.4);margin-bottom:7px;transition:var(--tr)}
.fit:hover{background:rgba(0,40,80,.5)}
.fito{font-size:18px}.fitn{flex:1;font-size:12.5px}
.fitb{font-size:10px;color:var(--green);font-family:var(--fd);letter-spacing:.5px}
.avo .fitb{color:var(--red)}
/* Free-text nutrition input */
.nutr-input-wrap{margin-bottom:28px}
.nutr-input-row{display:flex;gap:12px;align-items:flex-end}
.nutr-input-row .fg{flex:1}
.food-loading{display:none;align-items:center;gap:10px;font-family:var(--fd);font-size:10px;letter-spacing:2px;color:var(--teal);padding:14px}
.food-loading.show{display:flex}
.food-loading-spin{width:14px;height:14px;border:2px solid rgba(0,212,170,.3);border-top-color:var(--teal);border-radius:50%;animation:spin .8s linear infinite}

/* ══════════════════════════════
   CONSULT CORNER PAGE
══════════════════════════════ */
.consult-grid{display:grid;grid-template-columns:1.1fr 1fr;gap:28px;padding:36px 0}
.consult-right{display:flex;flex-direction:column;gap:20px}
.severity-bar{display:flex;gap:8px;margin-top:14px}
.sev-item{flex:1;text-align:center;padding:10px 6px;border-radius:8px;border:1px solid var(--border);font-family:var(--fd);font-size:8.5px;letter-spacing:1px;text-transform:uppercase;transition:var(--tr);cursor:default}
.sev-item.active-low{background:rgba(0,255,136,.1);border-color:var(--green);color:var(--green)}
.sev-item.active-mod{background:rgba(255,140,0,.1);border-color:var(--orange);color:var(--orange)}
.sev-item.active-high{background:rgba(255,45,85,.1);border-color:var(--red);color:var(--red)}
.remedy-list{display:flex;flex-direction:column;gap:8px;margin-top:12px}
.remedy-item{padding:10px 14px;border-radius:8px;background:rgba(0,20,40,.4);border:1px solid var(--border);font-size:13px;display:flex;align-items:center;gap:9px}
.telehealth-btns{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
.tele-btn{padding:20px;border-radius:12px;border:1px solid var(--border);background:rgba(0,20,40,.4);cursor:pointer;text-align:center;transition:var(--tr);display:flex;flex-direction:column;align-items:center;gap:10px}
.tele-btn:hover{transform:translateY(-3px)}
.tele-btn.video{border-color:var(--cyan);background:rgba(0,245,255,.05)}
.tele-btn.video:hover{box-shadow:0 0 28px rgba(0,245,255,.2)}
.tele-btn.audio{border-color:var(--teal);background:rgba(0,212,170,.05)}
.tele-btn.audio:hover{box-shadow:0 0 28px rgba(0,212,170,.2)}
.tele-icon{font-size:36px}
.tele-label{font-family:var(--fd);font-size:10px;letter-spacing:1.5px;text-transform:uppercase}
.tele-sub{font-size:11px;color:var(--txt2)}
.doc-card{display:flex;align-items:center;gap:14px;padding:14px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.35);margin-bottom:10px;transition:var(--tr)}
.doc-card:hover{border-color:var(--borderg);background:rgba(0,30,60,.5)}
.doc-avatar{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,rgba(0,100,200,.4),rgba(0,200,180,.4));border:1px solid var(--borderg);display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.doc-info{flex:1}
.doc-name{font-family:var(--fd);font-size:11px;font-weight:700;color:var(--txt);margin-bottom:2px}
.doc-spec{font-size:11.5px;color:var(--txt2)}
.doc-status{font-size:10px;color:var(--green);display:flex;align-items:center;gap:5px;margin-top:3px}
.doc-status::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);flex-shrink:0}
.consult-result{display:none;padding:22px;margin-top:14px}
.consult-result.visible{display:block}

/* ══════════════════════════════
   RESPONSIVE
══════════════════════════════ */
@media(max-width:1024px){
  .dsg{grid-template-columns:repeat(2,1fr)}
  .cr{grid-template-columns:1fr}
  .consult-grid{grid-template-columns:1fr}
  .medcheck-wrap{grid-template-columns:1fr}
}
@media(max-width:768px){
  .ham{display:flex}
  .nl{position:fixed;top:58px;left:0;right:0;background:rgba(1,10,18,.97);backdrop-filter:blur(20px);flex-direction:column;padding:20px;gap:6px;border-bottom:1px solid var(--border);transform:translateY(-100%);opacity:0;pointer-events:none;transition:var(--tr)}
  .nl.open{transform:translateY(0);opacity:1;pointer-events:all}
  .hl{grid-template-columns:1fr}
  .bp2{min-height:unset;padding:28px 14px}
  .bsw{width:170px}
  .vl{grid-template-columns:1fr}
  .cr{grid-template-columns:1fr}
  .fr2{grid-template-columns:1fr}
  .dsg{grid-template-columns:repeat(2,1fr)}
  .fg2{grid-template-columns:1fr}
  .asb{flex-direction:column}
  .wrap{padding:0 14px}
  .telehealth-btns{grid-template-columns:1fr}
  .nutr-input-row{flex-direction:column}
}
@media(max-width:480px){.dsg{grid-template-columns:1fr}}

/* ══════════════════════════════
   TELEHEALTH — CONSULT DOCTOR
══════════════════════════════ */
.region-hero{padding:48px 0 28px;text-align:center}
.region-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:36px}
@media(max-width:900px){.region-grid{grid-template-columns:repeat(2,1fr)}}
@media(max-width:480px){.region-grid{grid-template-columns:1fr}}
.region-step{padding:22px;border-radius:12px;background:var(--card);border:1px solid var(--border);transition:var(--tr)}
.region-step:hover{border-color:var(--borderg);transform:translateY(-2px)}
.rs-num{font-family:var(--fd);font-size:28px;font-weight:900;color:var(--cyan);opacity:.3;margin-bottom:6px}
.rs-label{font-family:var(--fd);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--teal);margin-bottom:10px}

/* Triage cards */
.triage-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px;margin:28px 0}
@media(max-width:768px){.triage-grid{grid-template-columns:1fr}}
.triage-card{padding:28px;border-radius:16px;border:1px solid;position:relative;overflow:hidden;cursor:pointer;transition:var(--tr)}
.triage-card::before{content:'';position:absolute;inset:0;opacity:.04;background:currentColor}
.triage-card:hover{transform:translateY(-4px);box-shadow:0 12px 48px rgba(0,0,0,.4)}
.triage-card.easy{border-color:var(--green);color:var(--green)}
.triage-card.moderate{border-color:var(--orange);color:var(--orange)}
.triage-card.critical{border-color:var(--red);color:var(--red)}
.triage-level{font-size:44px;margin-bottom:12px}
.triage-title{font-family:var(--fd);font-size:14px;font-weight:700;margin-bottom:8px}
.triage-sub{font-size:12px;color:var(--txt2);line-height:1.6;margin-bottom:16px}
.triage-price{font-family:var(--fd);font-size:11px;letter-spacing:1px;padding:8px 14px;border-radius:8px;border:1px solid currentColor;background:rgba(0,0,0,.3);display:inline-block;margin-bottom:14px}
.triage-features{display:flex;flex-direction:column;gap:7px}
.tf{font-size:12px;color:var(--txt2);display:flex;align-items:center;gap:8px}
.tf::before{content:'✓';font-family:var(--fd);font-size:10px;color:inherit;flex-shrink:0}

/* Doctors list */
.doctors-section{margin-top:36px}
.doctor-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;margin-top:18px}
.doctor-full-card{padding:22px;border-radius:14px;background:var(--card);border:1px solid var(--border);transition:var(--tr)}
.doctor-full-card:hover{border-color:var(--borderg);transform:translateY(-3px)}
.dfc-top{display:flex;align-items:center;gap:14px;margin-bottom:14px}
.dfc-avatar{width:52px;height:52px;border-radius:50%;background:linear-gradient(135deg,#004488,#006655);border:2px solid var(--borderg);display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
.dfc-name{font-family:var(--fd);font-size:12px;font-weight:700;color:var(--txt)}
.dfc-spec{font-size:11.5px;color:var(--txt2);margin-top:2px}
.dfc-rating{font-size:11px;color:var(--orange);margin-top:2px}
.dfc-badges{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:12px}
.dfc-actions{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.dfc-btn{padding:10px;border-radius:8px;font-family:var(--fd);font-size:9px;letter-spacing:1px;text-transform:uppercase;border:1px solid;background:transparent;cursor:pointer;transition:var(--tr);text-align:center}
.dfc-btn.video{border-color:var(--cyan);color:var(--cyan)}
.dfc-btn.video:hover{background:rgba(0,245,255,.1);box-shadow:0 0 18px rgba(0,245,255,.2)}
.dfc-btn.visit{border-color:var(--teal);color:var(--teal)}
.dfc-btn.visit:hover{background:rgba(0,212,170,.1);box-shadow:0 0 18px rgba(0,212,170,.2)}

/* Video Call Modal */
.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(8px);z-index:8000;display:none;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal-box{background:var(--bg-mid);border:1px solid var(--borderg);border-radius:18px;padding:36px;max-width:560px;width:95%;position:relative;box-shadow:0 0 80px rgba(0,245,255,.1)}
.modal-close{position:absolute;top:16px;right:16px;background:transparent;border:1px solid var(--border);color:var(--txt2);width:32px;height:32px;border-radius:50%;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;transition:var(--tr)}
.modal-close:hover{border-color:var(--red);color:var(--red)}
.video-call-ui{display:flex;flex-direction:column;gap:20px;align-items:center}
.vcam{width:100%;aspect-ratio:16/9;background:linear-gradient(135deg,rgba(0,20,40,.9),rgba(0,40,80,.6));border-radius:12px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:60px;position:relative;overflow:hidden}
.vcam-label{position:absolute;bottom:12px;left:12px;font-family:var(--fd);font-size:9px;letter-spacing:2px;color:var(--txt2);background:rgba(0,0,0,.6);padding:4px 10px;border-radius:4px}
.vcam-status{position:absolute;top:12px;right:12px;width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 8px var(--red);animation:pulse 1.5s ease-in-out infinite}
.vcam-status.live{background:var(--green);box-shadow:0 0 8px var(--green)}
.vc-controls{display:flex;gap:12px}
.vc-ctrl{width:48px;height:48px;border-radius:50%;border:1px solid var(--border);background:rgba(0,20,40,.6);color:var(--txt2);font-size:18px;cursor:pointer;transition:var(--tr);display:flex;align-items:center;justify-content:center}
.vc-ctrl:hover{border-color:var(--cyan);color:var(--cyan)}
.vc-ctrl.end{border-color:var(--red);background:rgba(255,45,85,.15);color:var(--red)}
.vc-ctrl.end:hover{background:rgba(255,45,85,.3);box-shadow:0 0 20px rgba(255,45,85,.4)}

/* ══════════════════════════════
   EMERGENCY PAGE
══════════════════════════════ */
.emergency-hero{padding:40px 0 24px;text-align:center;position:relative}
.emergency-pulse{display:flex;align-items:center;justify-content:center;margin:28px 0}
.ep-ring{position:absolute;width:120px;height:120px;border-radius:50%;border:2px solid var(--red);opacity:0;animation:ering 2s ease-out infinite}
.ep-ring:nth-child(2){animation-delay:.7s}
.ep-ring:nth-child(3){animation-delay:1.4s}
@keyframes ering{0%{width:80px;height:80px;opacity:.8}100%{width:200px;height:200px;opacity:0}}
.ep-btn{width:90px;height:90px;border-radius:50%;background:rgba(255,45,85,.15);border:2px solid var(--red);color:var(--red);font-size:36px;cursor:pointer;position:relative;z-index:1;transition:var(--tr);display:flex;align-items:center;justify-content:center;box-shadow:0 0 36px rgba(255,45,85,.3)}
.ep-btn:hover{background:rgba(255,45,85,.3);box-shadow:0 0 60px rgba(255,45,85,.5);transform:scale(1.07)}
.emg-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin:28px 0}
@media(max-width:768px){.emg-grid{grid-template-columns:1fr}}
.emg-card{padding:24px;border-radius:14px;background:var(--card);border:1px solid var(--border)}
.emg-title{font-family:var(--fd);font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.critical-symptoms{display:flex;flex-direction:column;gap:8px;margin-top:14px}
.cs-item{display:flex;align-items:center;gap:12px;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);cursor:pointer;transition:var(--tr)}
.cs-item:hover{border-color:var(--red);background:rgba(255,45,85,.07)}
.cs-item.selected{border-color:var(--red);background:rgba(255,45,85,.1);box-shadow:0 0 14px rgba(255,45,85,.15)}
.cs-icon{font-size:22px;flex-shrink:0}
.cs-text{flex:1}
.cs-name{font-size:13px;font-weight:600;color:var(--txt)}
.cs-desc{font-size:11px;color:var(--txt2);margin-top:2px}
.cs-severity{font-family:var(--fd);font-size:9px;letter-spacing:1px;padding:3px 8px;border-radius:12px;background:rgba(255,45,85,.1);border:1px solid var(--red);color:var(--red)}
.ambulance-tracker{padding:24px;border-radius:14px;background:var(--card);border:1px solid var(--borderg)}
.tracker-map{height:200px;background:linear-gradient(135deg,rgba(0,20,40,.9),rgba(0,40,80,.6));border-radius:10px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:14px;color:var(--txt2);font-family:var(--fd);letter-spacing:2px;position:relative;overflow:hidden;margin-bottom:14px}
.tracker-map::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 30px,rgba(0,245,255,.03) 30px,rgba(0,245,255,.03) 31px),repeating-linear-gradient(90deg,transparent,transparent 30px,rgba(0,245,255,.03) 30px,rgba(0,245,255,.03) 31px)}
.amb-dot{position:absolute;width:16px;height:16px;border-radius:50%;background:var(--red);box-shadow:0 0 12px var(--red);animation:pulse 1s ease-in-out infinite}
.emg-actions{display:flex;flex-direction:column;gap:10px;margin-top:16px}
.emg-action-btn{padding:14px 20px;border-radius:10px;border:1px solid;background:transparent;color:inherit;font-family:var(--fd);font-size:10px;letter-spacing:1.5px;text-transform:uppercase;cursor:pointer;transition:var(--tr);display:flex;align-items:center;gap:10px;width:100%}
.emg-action-btn.red{border-color:var(--red);color:var(--red)}
.emg-action-btn.red:hover{background:rgba(255,45,85,.1);box-shadow:0 0 20px rgba(255,45,85,.2)}
.emg-action-btn.blue{border-color:var(--blue);color:var(--blue)}
.emg-action-btn.blue:hover{background:rgba(0,128,255,.1)}
.emg-action-btn.green{border-color:var(--green);color:var(--green)}
.emg-action-btn.green:hover{background:rgba(0,255,136,.07)}
.hospital-list{display:flex;flex-direction:column;gap:10px;margin-top:14px}
.hosp-item{display:flex;align-items:center;gap:14px;padding:14px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);transition:var(--tr)}
.hosp-item:hover{border-color:var(--borderg)}
.hosp-icon{font-size:28px;flex-shrink:0}
.hosp-info{flex:1}
.hosp-name{font-family:var(--fd);font-size:11px;font-weight:600;color:var(--txt)}
.hosp-dist{font-size:11px;color:var(--txt2);margin-top:2px}
.hosp-beds{font-family:var(--fd);font-size:10px;padding:4px 10px;border-radius:12px;border:1px solid var(--green);color:var(--green);background:rgba(0,255,136,.06);white-space:nowrap}
.hosp-beds.low{border-color:var(--orange);color:var(--orange);background:rgba(255,140,0,.06)}
.hosp-beds.full{border-color:var(--red);color:var(--red);background:rgba(255,45,85,.06)}

/* Emergency Alert */
.emg-alert{position:fixed;inset:0;background:rgba(0,0,0,.92);z-index:9500;display:none;align-items:center;justify-content:center}
.emg-alert.show{display:flex}
.emg-alert-box{background:#100008;border:2px solid var(--red);border-radius:20px;padding:40px;max-width:480px;width:95%;text-align:center;box-shadow:0 0 100px rgba(255,45,85,.3),0 0 200px rgba(255,45,85,.1);animation:alertpop .4s cubic-bezier(.34,1.56,.64,1)}
@keyframes alertpop{from{transform:scale(.8);opacity:0}}
.emg-alert-icon{font-size:64px;margin-bottom:16px;animation:pulse 1s ease-in-out infinite}
.emg-alert-title{font-family:var(--fd);font-size:20px;font-weight:900;color:var(--red);letter-spacing:2px;margin-bottom:10px;text-shadow:0 0 20px rgba(255,45,85,.5)}
.emg-alert-sub{font-size:14px;color:var(--txt2);line-height:1.7;margin-bottom:24px}
.emg-confirm-btns{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.emg-confirm-btn{padding:14px;border-radius:10px;font-family:var(--fd);font-size:10px;letter-spacing:2px;border:1px solid;background:transparent;cursor:pointer;transition:var(--tr)}
.emg-confirm-btn.confirm{border-color:var(--red);color:var(--red)}
.emg-confirm-btn.confirm:hover{background:rgba(255,45,85,.15);box-shadow:0 0 24px rgba(255,45,85,.3)}
.emg-confirm-btn.cancel{border-color:var(--border);color:var(--txt2)}
.emg-confirm-btn.cancel:hover{border-color:var(--cyan);color:var(--cyan)}

/* ══════════════════════════════
   APPOINTMENTS PAGE
══════════════════════════════ */
.appt-tabs{display:flex;gap:8px;margin-bottom:28px;border-bottom:1px solid var(--border);padding-bottom:16px}
.appt-tab{font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;padding:9px 18px;border-radius:8px;border:1px solid transparent;background:transparent;color:var(--txt2);cursor:pointer;transition:var(--tr)}
.appt-tab:hover,.appt-tab.active{border-color:var(--cyan);color:var(--cyan);background:rgba(0,245,255,.05)}
.appt-list{display:flex;flex-direction:column;gap:14px}
.appt-item{padding:22px;border-radius:14px;background:var(--card);border:1px solid var(--border);display:grid;grid-template-columns:auto 1fr auto;gap:18px;align-items:center;transition:var(--tr)}
.appt-item:hover{border-color:var(--borderg)}
@media(max-width:600px){.appt-item{grid-template-columns:1fr;gap:10px}}
.appt-date-box{text-align:center;padding:12px 16px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.5);min-width:72px}
.appt-day{font-family:var(--fd);font-size:22px;font-weight:700;color:var(--cyan)}
.appt-month{font-family:var(--fd);font-size:9px;letter-spacing:2px;color:var(--txt2);text-transform:uppercase}
.appt-info{flex:1}
.appt-doc{font-family:var(--fd);font-size:12px;font-weight:600;color:var(--txt)}
.appt-type{font-size:12px;color:var(--txt2);margin-top:3px}
.appt-time{font-family:var(--fd);font-size:10px;color:var(--teal);margin-top:4px;display:flex;align-items:center;gap:6px}
.appt-actions{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
.appt-badge{font-family:var(--fd);font-size:9px;letter-spacing:1px;padding:5px 12px;border-radius:12px;text-transform:uppercase}
.appt-badge.upcoming{background:rgba(0,128,255,.1);border:1px solid var(--blue);color:var(--blue)}
.appt-badge.completed{background:rgba(0,255,136,.07);border:1px solid var(--green);color:var(--green)}
.appt-badge.cancelled{background:rgba(255,45,85,.07);border:1px solid var(--red);color:var(--red)}
.book-slot-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:8px;margin-top:14px}
.time-slot{padding:10px 6px;border-radius:8px;border:1px solid var(--border);background:transparent;color:var(--txt2);font-family:var(--fd);font-size:9.5px;text-align:center;cursor:pointer;transition:var(--tr)}
.time-slot:hover,.time-slot.sel{border-color:var(--cyan);color:var(--cyan);background:rgba(0,245,255,.05)}
.time-slot.taken{opacity:.3;cursor:not-allowed;pointer-events:none}
.qr-box{display:flex;flex-direction:column;align-items:center;gap:12px;padding:24px;border-radius:14px;background:rgba(0,20,40,.5);border:1px solid var(--border)}
.qr-code{width:120px;height:120px;background:white;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:10px;color:#000;font-family:monospace;position:relative;overflow:hidden}
.qr-code::before{content:'';position:absolute;inset:8px;background:repeating-conic-gradient(#000 0%,#000 25%,white 25%,white 50%) 0 0/8px 8px;opacity:.85}

/* ══════════════════════════════
   BILLING PAGE
══════════════════════════════ */
.billing-grid{display:grid;grid-template-columns:1.3fr 1fr;gap:24px;margin-top:28px}
@media(max-width:900px){.billing-grid{grid-template-columns:1fr}}
.wallet-card{padding:32px;border-radius:16px;background:linear-gradient(135deg,rgba(0,40,100,.6),rgba(0,80,80,.4));border:1px solid var(--borderg);position:relative;overflow:hidden}
.wallet-card::before{content:'';position:absolute;top:-30px;right:-30px;width:180px;height:180px;border-radius:50%;background:radial-gradient(circle,rgba(0,245,255,.07),transparent 70%)}
.wallet-balance{font-family:var(--fd);font-size:40px;font-weight:900;color:var(--cyan);text-shadow:0 0 20px rgba(0,245,255,.4);margin-bottom:6px}
.wallet-label{font-family:var(--fd);font-size:9px;letter-spacing:3px;text-transform:uppercase;color:var(--txt2);margin-bottom:24px}
.wallet-actions{display:flex;gap:10px}
.w-btn{padding:10px 20px;border-radius:8px;font-family:var(--fd);font-size:9px;letter-spacing:1.5px;text-transform:uppercase;border:1px solid var(--borderg);background:rgba(0,245,255,.08);color:var(--cyan);cursor:pointer;transition:var(--tr)}
.w-btn:hover{background:rgba(0,245,255,.15);box-shadow:0 0 18px rgba(0,245,255,.2)}
.txn-list{display:flex;flex-direction:column;gap:10px;margin-top:18px}
.txn{display:flex;align-items:center;gap:14px;padding:14px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);transition:var(--tr)}
.txn:hover{border-color:var(--borderg)}
.txn-icon{font-size:20px;width:36px;height:36px;border-radius:50%;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.txn-info{flex:1}
.txn-title{font-size:13px;font-weight:600;color:var(--txt)}
.txn-date{font-size:11px;color:var(--txt2);margin-top:2px}
.txn-amount{font-family:var(--fd);font-size:13px;font-weight:700}
.txn-amount.credit{color:var(--green)}
.txn-amount.debit{color:var(--red)}
.commission-breakdown{padding:22px;border-radius:12px;background:var(--card);border:1px solid var(--border);margin-bottom:18px}
.commission-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(0,100,150,.1);font-size:13px}
.commission-row:last-child{border-bottom:none;font-weight:700}
.commission-row .label{color:var(--txt2)}
.commission-row .value{font-family:var(--fd);font-size:12px;color:var(--cyan)}
.payment-methods{display:flex;flex-direction:column;gap:10px;margin-top:18px}
.pay-method{display:flex;align-items:center;gap:14px;padding:14px 18px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);cursor:pointer;transition:var(--tr)}
.pay-method:hover,.pay-method.selected{border-color:var(--cyan);background:rgba(0,245,255,.05)}
.pay-icon{font-size:24px;flex-shrink:0}
.pay-name{font-family:var(--fd);font-size:10.5px;font-weight:600;color:var(--txt)}
.pay-sub{font-size:11px;color:var(--txt2);margin-top:2px}
.pay-check{width:18px;height:18px;border-radius:50%;border:1px solid var(--border);margin-left:auto;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:10px;color:transparent}
.pay-method.selected .pay-check{border-color:var(--cyan);color:var(--cyan);background:rgba(0,245,255,.1)}

/* ══════════════════════════════
   ADMIN DASHBOARD PAGE
══════════════════════════════ */
.admin-header{padding:32px 0 20px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:14px}
.admin-kpi{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:28px}
@media(max-width:900px){.admin-kpi{grid-template-columns:repeat(2,1fr)}}
@media(max-width:480px){.admin-kpi{grid-template-columns:1fr}}
.kpi-card{padding:24px;border-radius:14px;background:var(--card);border:1px solid var(--border);position:relative;overflow:hidden;transition:var(--tr)}
.kpi-card:hover{border-color:var(--borderg);transform:translateY(-2px)}
.kpi-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px}
.kpi-card.cyan::after{background:linear-gradient(90deg,transparent,var(--cyan),transparent)}
.kpi-card.green::after{background:linear-gradient(90deg,transparent,var(--green),transparent)}
.kpi-card.orange::after{background:linear-gradient(90deg,transparent,var(--orange),transparent)}
.kpi-card.red::after{background:linear-gradient(90deg,transparent,var(--red),transparent)}
.kpi-icon{font-size:28px;margin-bottom:10px}
.kpi-val{font-family:var(--fd);font-size:26px;font-weight:700;margin-bottom:4px}
.kpi-card.cyan .kpi-val{color:var(--cyan)}
.kpi-card.green .kpi-val{color:var(--green)}
.kpi-card.orange .kpi-val{color:var(--orange)}
.kpi-card.red .kpi-val{color:var(--red)}
.kpi-lbl{font-size:10.5px;color:var(--dim);letter-spacing:1px;text-transform:uppercase}
.kpi-trend{font-family:var(--fd);font-size:9px;letter-spacing:1px;margin-top:6px;color:var(--green)}
.admin-grid{display:grid;grid-template-columns:1.5fr 1fr;gap:20px;margin-bottom:24px}
@media(max-width:900px){.admin-grid{grid-template-columns:1fr}}
.admin-table{width:100%;border-collapse:collapse;font-size:12.5px}
.admin-table th{font-family:var(--fd);font-size:9px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2);padding:12px 16px;text-align:left;border-bottom:1px solid var(--border);background:rgba(0,20,40,.5)}
.admin-table td{padding:12px 16px;border-bottom:1px solid rgba(0,100,150,.08);color:var(--txt)}
.admin-table tr:hover td{background:rgba(0,245,255,.02)}
.admin-table tr:last-child td{border-bottom:none}
.region-map{height:260px;background:linear-gradient(135deg,rgba(0,15,30,.9),rgba(0,30,60,.6));border-radius:10px;border:1px solid var(--border);display:flex;align-items:center;justify-content:center;position:relative;overflow:hidden;margin-bottom:14px}
.region-map::before{content:'';position:absolute;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 20px,rgba(0,245,255,.02) 20px,rgba(0,245,255,.02) 21px),repeating-linear-gradient(90deg,transparent,transparent 20px,rgba(0,245,255,.02) 20px,rgba(0,245,255,.02) 21px)}
.rmap-dot{position:absolute;width:10px;height:10px;border-radius:50%;background:var(--cyan);box-shadow:0 0 10px var(--cyan)}
.rmap-dot::after{content:attr(data-label);position:absolute;left:14px;top:50%;transform:translateY(-50%);font-family:var(--fd);font-size:8.5px;color:var(--cyan);white-space:nowrap;letter-spacing:1px}
.doctor-pending{display:flex;flex-direction:column;gap:10px;margin-top:14px}
.dp-item{display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:10px;border:1px solid var(--border);background:rgba(0,20,40,.4);transition:var(--tr)}
.dp-item:hover{border-color:var(--borderg)}
.dp-avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg,#003366,#005544);border:1px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}
.dp-info{flex:1}
.dp-name{font-family:var(--fd);font-size:11px;font-weight:600;color:var(--txt)}
.dp-spec{font-size:11px;color:var(--txt2);margin-top:2px}
.dp-actions{display:flex;gap:6px}
.dp-btn{padding:6px 12px;border-radius:6px;font-family:var(--fd);font-size:8.5px;letter-spacing:1px;border:1px solid;background:transparent;cursor:pointer;transition:var(--tr)}
.dp-btn.approve{border-color:var(--green);color:var(--green)}
.dp-btn.approve:hover{background:rgba(0,255,136,.1)}
.dp-btn.reject{border-color:var(--red);color:var(--red)}
.dp-btn.reject:hover{background:rgba(255,45,85,.1)}
.revenue-chart-wrap{padding:22px;border-radius:12px;background:var(--card);border:1px solid var(--border)}
</style>
</head>
<body>

<!-- Loader -->
<div id="ls"><div class="lr"></div><div class="lt" id="lt">Initializing VITREOS...</div></div>

<!-- BG -->
<div class="bgr"></div>
<canvas id="pc"></canvas>

<!-- Nav -->
<nav>
  <div class="logo" onclick="goPage('home')">VITRE<span>OS</span></div>
  <ul class="nl" id="nl">
    <li><button onclick="goPage('home')" data-p="home">Advisor</button></li>
    <li><button onclick="goPage('voice')" data-p="voice">Voice</button></li>
    <li><button onclick="goPage('allergy')" data-p="allergy">Allergies</button></li>
    <li><button onclick="goPage('analyzer')" data-p="analyzer">Analyzer</button></li>
    <li><button onclick="goPage('consult')" data-p="consult">Consult Corner</button></li>
    <li><button onclick="goPage('dash')" data-p="dash">Dashboard</button></li>
    <li><button onclick="goPage('food')" data-p="food">Nutrition</button></li>
    <li><button onclick="goPage('telehealth')" data-p="telehealth" style="color:var(--cyan)">🩺 Consult Doctor</button></li>
    <li><button onclick="goPage('emergency')" data-p="emergency" style="color:var(--red)">🚨 Emergency</button></li>
    <li><button onclick="goPage('appointments')" data-p="appointments">📅 Appointments</button></li>
    <li><button onclick="goPage('billing')" data-p="billing">💰 Billing</button></li>
    <li><button onclick="goPage('admindash')" data-p="admindash">⚙️ Admin</button></li>
  </ul>
  <div class="nav-r">
    <div class="lang-wrap">
      <select class="lang-sel" id="langSel" onchange="setLang(this.value)">
        <option value="en">🇬🇧 English</option>
        <option value="hi">🇮🇳 हिंदी</option>
        <option value="bn">🇧🇩 বাংলা</option>
        <option value="te">🇮🇳 తెలుగు</option>
        <option value="mr">🇮🇳 मराठी</option>
        <option value="ta">🇮🇳 தமிழ்</option>
        <option value="es">🇪🇸 Español</option>
        <option value="fr">🇫🇷 Français</option>
        <option value="de">🇩🇪 Deutsch</option>
      </select>
    </div>
    <button class="tbtn" id="tbtn">☀️</button>
    <div class="ham" id="ham"><span></span><span></span><span></span></div>
  </div>
</nav>

<!-- Toast -->
<div id="tc"></div>

<!-- ══════════ HOME PAGE ══════════ -->
<div class="page active" id="page-home">
<div class="wrap">
  <div class="hl">
    <!-- Body Panel -->
    <div class="gc bp2">
      <div class="bpt" data-i18n="bioInterface">Biological Interface</div>
      <div class="scan"></div>
      <div class="bsw">
        <svg class="bsvg" viewBox="0 0 200 500" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <filter id="gw"><feGaussianBlur stdDeviation="3" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            <linearGradient id="bg1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#00f5ff" stop-opacity=".7"/>
              <stop offset="50%" stop-color="#00d4aa" stop-opacity=".8"/>
              <stop offset="100%" stop-color="#0080ff" stop-opacity=".6"/>
            </linearGradient>
          </defs>
          <g filter="url(#gw)" stroke="url(#bg1)" stroke-width="1.5" fill="none">
            <ellipse cx="100" cy="38" rx="30" ry="35" fill="rgba(0,245,255,.04)"/>
            <rect x="89" y="70" width="22" height="20" rx="4" fill="rgba(0,200,200,.05)"/>
            <path d="M60,90 L45,160 L50,260 L150,260 L155,160 L140,90 Z" fill="rgba(0,180,220,.04)"/>
            <path d="M60,90 C40,95 25,120 20,140 L25,145 C30,125 42,105 65,100"/>
            <path d="M140,90 C160,95 175,120 180,140 L175,145 C170,125 158,105 135,100"/>
            <path d="M25,140 C20,160 15,200 18,240" stroke-width="13" stroke-linecap="round" stroke="rgba(0,180,220,.28)"/>
            <path d="M25,140 C20,160 15,200 18,240" stroke-width="1.2" stroke-linecap="round"/>
            <ellipse cx="18" cy="248" rx="10" ry="13" fill="rgba(0,180,220,.05)"/>
            <path d="M175,140 C180,160 185,200 182,240" stroke-width="13" stroke-linecap="round" stroke="rgba(0,180,220,.28)"/>
            <path d="M175,140 C180,160 185,200 182,240" stroke-width="1.2" stroke-linecap="round"/>
            <ellipse cx="182" cy="248" rx="10" ry="13" fill="rgba(0,180,220,.05)"/>
            <path d="M50,260 C50,285 70,295 100,295 C130,295 150,285 150,260" fill="rgba(0,160,200,.06)"/>
            <path d="M70,295 C65,340 60,380 62,430" stroke-width="19" stroke-linecap="round" stroke="rgba(0,160,200,.23)"/>
            <path d="M70,295 C65,340 60,380 62,430" stroke-width="1.2" stroke-linecap="round"/>
            <path d="M130,295 C135,340 140,380 138,430" stroke-width="19" stroke-linecap="round" stroke="rgba(0,160,200,.23)"/>
            <path d="M130,295 C135,340 140,380 138,430" stroke-width="1.2" stroke-linecap="round"/>
            <ellipse cx="58" cy="440" rx="13" ry="8" fill="rgba(0,180,220,.05)"/>
            <ellipse cx="142" cy="440" rx="13" ry="8" fill="rgba(0,180,220,.05)"/>
            <line x1="100" y1="88" x2="100" y2="260" stroke="rgba(0,245,255,.28)" stroke-dasharray="4,4"/>
            <path d="M80,120 C70,130 68,140 75,145" stroke="rgba(0,245,255,.22)" stroke-width="1"/>
            <path d="M120,120 C130,130 132,140 125,145" stroke="rgba(0,245,255,.22)" stroke-width="1"/>
            <path d="M78,136 C66,146 65,156 72,161" stroke="rgba(0,245,255,.17)" stroke-width="1"/>
            <path d="M122,136 C134,146 135,156 128,161" stroke="rgba(0,245,255,.17)" stroke-width="1"/>
            <path d="M68,92 C85,88 100,86 115,88 C132,90 140,94 143,92"/>
          </g>
          <g filter="url(#gw)" transform="translate(82,140)">
            <path d="M18,6 C18,3 16,0 13,0 C10,0 8,3 8,3 C8,3 6,0 3,0 C0,0 -2,3 -2,6 C-2,9 8,20 8,20 C8,20 18,9 18,6 Z" fill="rgba(255,80,100,.6)" stroke="rgba(255,100,120,.9)" stroke-width=".8">
              <animate attributeName="opacity" values=".6;1;.6" dur="1.2s" repeatCount="indefinite"/>
            </path>
          </g>
          <circle cx="100" cy="25" r="4" fill="rgba(0,245,255,.5)" filter="url(#gw)"><animate attributeName="r" values="3;5;3" dur="2s" repeatCount="indefinite"/></circle>
          <circle cx="100" cy="180" r="80" fill="none" stroke="rgba(0,245,255,.05)" stroke-width="1" stroke-dasharray="8,4"/>
          <circle cx="100" cy="180" r="100" fill="none" stroke="rgba(0,180,200,.04)" stroke-width="1" stroke-dasharray="6,6"><animateTransform attributeName="transform" type="rotate" from="0 100 180" to="360 100 180" dur="20s" repeatCount="indefinite"/></circle>
        </svg>
        <div class="hs" data-l="Brain" style="top:4%;left:44%"></div>
        <div class="hs" data-l="Heart" style="top:27%;left:37%;background:#ff4d8d;box-shadow:0 0 9px #ff4d8d"></div>
        <div class="hs" data-l="Lungs" style="top:24%;left:59%"></div>
        <div class="hs" data-l="Liver" style="top:34%;left:58%"></div>
        <div class="hs" data-l="Kidneys" style="top:42%;left:39%"></div>
      </div>
      <div class="bstats">
        <div class="bstat"><div class="bsv" id="sv1">0%</div><div class="bsl">Accuracy</div></div>
        <div class="bstat"><div class="bsv" id="sv2">0</div><div class="bsl">Scanned</div></div>
        <div class="bstat"><div class="bsv" id="sv3">0</div><div class="bsl">Organs</div></div>
      </div>
    </div>

    <!-- Advisor Form -->
    <div class="gc ap">
      <div style="margin-bottom:24px">
        <div class="stag" data-i18n="neuralEngine">⚕ Neural Analysis Engine</div>
        <h1 class="stitle">AI Medical <span class="ac">Advisor</span></h1>
        <p class="ssub" data-i18n="advisorSub">Enter your medical profile for instant AI-powered drug interaction and reaction analysis.</p>
      </div>
      <form id="af" autocomplete="off">
        <div class="fg2">
          <div class="fg">
            <label class="fl" data-i18n="bloodGroup">Blood Group</label>
            <select class="fs" name="bg" required>
              <option value="">Select type</option>
              <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
            </select>
          </div>
          <div class="fg">
            <label class="fl" data-i18n="bloodPressure">Blood Pressure (Systolic)</label>
            <input class="fi" type="number" name="bp" placeholder="e.g. 120" min="60" max="220">
          </div>
          <!-- CBC Fields -->
          <div class="fg">
            <label class="fl">WBC Count (×10³/µL)</label>
            <input class="fi" type="number" name="wbc" placeholder="Normal: 4.5–11.0" min="0" max="100" step="0.1">
          </div>
          <div class="fg">
            <label class="fl">Platelet Count (×10³/µL)</label>
            <input class="fi" type="number" name="plt" placeholder="Normal: 150–400" min="0" max="1500">
          </div>
          <div class="fg">
            <label class="fl">Hemoglobin (g/dL)</label>
            <input class="fi" type="number" name="hgb" placeholder="Normal: 12–17.5" min="0" max="25" step="0.1">
          </div>
          <div class="fg">
            <label class="fl">Hematocrit (%)</label>
            <input class="fi" type="number" name="hct" placeholder="Normal: 36–52" min="0" max="70" step="0.1">
          </div>
          <div class="fg">
            <label class="fl">RBC Count (×10⁶/µL)</label>
            <input class="fi" type="number" name="rbc" placeholder="Normal: 4.2–5.9" min="0" max="10" step="0.1">
          </div>
          <div class="fg">
            <label class="fl">MCV (fL)</label>
            <input class="fi" type="number" name="mcv" placeholder="Normal: 80–100" min="0" max="150" step="0.1">
          </div>
          <div class="fg fw">
            <label class="fl" data-i18n="allergies">Known Allergies</label>
            <input class="fi" type="text" name="al" placeholder="e.g. Penicillin, Peanuts, Latex">
          </div>
          <div class="fg">
            <label class="fl" data-i18n="medications">Current Medication</label>
            <input class="fi" type="text" name="med" placeholder="e.g. Metformin, Aspirin">
          </div>
          <div class="fg">
            <label class="fl" data-i18n="dosage">Dosage</label>
            <input class="fi" type="text" name="dos" placeholder="e.g. 500mg twice daily">
          </div>
          <div class="fg fw">
            <label class="fl">Environmental Factors</label>
            <textarea class="fta" name="env" placeholder="e.g. High pollution, seasonal pollen, indoor mold..."></textarea>
          </div>
        </div>
        <button type="submit" class="btn bp abtn">
          <span class="abtnl"></span>
          <span class="abtnt" data-i18n="analyzeBtn">⚡ Analyze Reaction</span>
        </button>
      </form>
      <p style="font-size:10.5px;color:var(--dim);margin-top:14px;text-align:center;line-height:1.6" data-i18n="disclaimer">⚠ For informational purposes only. Consult a qualified physician.</p>
    </div>
  </div>

  <div class="nd"></div>

  <div style="padding-bottom:56px">
    <div class="stag">Neural Output</div>
    <h2 class="stitle">Predicted <span class="ac">Reactions</span></h2>
    <p class="ssub">AI-generated analysis of potential drug interactions, allergen responses, and environmental risks.</p>
    <div id="rg" class="rg">
      <div class="re"><div class="rei">🧬</div><p>Fill the form above to begin analysis</p></div>
    </div>
  </div>
</div>
</div>

<!-- ══════════ VOICE PAGE ══════════ -->
<div class="page" id="page-voice">
<div class="wrap">
  <div style="padding:36px 0 20px">
    <div class="stag">🎙 Neural Voice Interface</div>
    <h1 class="stitle">Voice <span class="ac">Medical Assistant</span></h1>
    <p class="ssub">Speak your symptoms naturally. AI listens, transcribes, and generates real-time medical analysis.</p>
  </div>
  <div class="vl">
    <div class="gc mc">
      <div class="stag2">Voice Recognition</div>
      <div class="mw" id="mw">
        <div class="mr"></div><div class="mr"></div><div class="mr"></div>
        <button class="mbtn" id="mbtn">🎙</button>
      </div>
      <div class="ms" id="ms">READY</div>
      <div class="wv" id="wv">
        <div class="wb" style="height:8px"></div><div class="wb" style="height:18px"></div>
        <div class="wb" style="height:28px"></div><div class="wb" style="height:32px"></div>
        <div class="wb" style="height:28px"></div><div class="wb" style="height:18px"></div>
        <div class="wb" style="height:8px"></div>
      </div>
      <p style="font-size:12.5px;color:var(--txt2);line-height:1.7;text-align:center;max-width:240px">Click mic to start.<br>Speak symptoms clearly.<br>Click again to stop.</p>
      <div style="display:flex;gap:10px;margin-top:18px;width:100%;justify-content:center">
        <button class="btn bp" id="vabtn" style="flex:1;justify-content:center">⚡ Analyze</button>
        <button class="btn bs" id="vcbtn">Clear</button>
      </div>
      <div style="margin-top:20px;width:100%;padding-top:18px;border-top:1px solid var(--border)">
        <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin-bottom:10px">Try saying:</div>
        <div style="font-size:12px;color:var(--txt2);line-height:2">"I have a headache and nausea"<br>"Feeling dizzy with chest pain"<br>"Persistent cough and fatigue"</div>
      </div>
    </div>
    <div style="display:flex;flex-direction:column;gap:20px">
      <div class="gc" style="padding:26px">
        <div class="stag2">Live Transcript</div>
        <div class="tb" id="vtr"><em style="color:var(--dim)">Speak to begin transcription...</em></div>
      </div>
      <div class="gc" style="padding:26px">
        <div class="stag2">Detected Symptoms</div>
        <div id="vsym" style="min-height:55px"><span style="font-size:12.5px;color:var(--dim);font-style:italic">Symptoms will appear here...</span></div>
      </div>
      <div class="gc" id="vres" style="padding:26px;display:none">
        <div id="vresc"></div>
      </div>
    </div>
  </div>
  <div class="nd"></div>
  <!-- Risk Analysis Block - verified by medical DB -->
  <div style="padding-bottom:56px">
    <div class="stag2" style="margin-bottom:18px">Risk Analysis</div>
    <div class="risk-verified gc" style="padding:24px;margin-bottom:20px">
      <div class="risk-verified-icon">🛡️</div>
      <div>
        <div class="risk-verified-title">Medical Database Verified</div>
        <div class="risk-verified-text">Everything is verified by a medical database. All symptom assessments, interaction flags, and risk classifications are cross-referenced against our comprehensive clinical repository to ensure accuracy and safety.</div>
      </div>
    </div>
    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px">
      <div class="gc fi2" style="padding:24px;text-align:center"><div style="font-size:32px;margin-bottom:12px">⚕</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:8px">Risk Analysis</div><p style="font-size:12.5px;color:var(--txt2)">Symptoms are cross-referenced against our verified medical database for accurate risk scoring.</p></div>
      <div class="gc fi2" style="padding:24px;text-align:center"><div style="font-size:32px;margin-bottom:12px">📊</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:8px">Pattern Recognition</div><p style="font-size:12.5px;color:var(--txt2)">AI models trained on millions of clinical cases identify symptom patterns and flag urgent conditions.</p></div>
      <div class="gc fi2" style="padding:24px;text-align:center"><div style="font-size:32px;margin-bottom:12px">🔒</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:8px">Clinical Accuracy</div><p style="font-size:12.5px;color:var(--txt2)">Continuous updates ensure our database reflects the latest medical guidelines and research.</p></div>
    </div>
  </div>
</div>
</div>

<!-- ══════════ ALLERGY PAGE ══════════ -->
<div class="page" id="page-allergy">
<div class="wrap">
  <div style="padding:36px 0 20px">
    <div class="stag">🧬 Immunological Database</div>
    <h1 class="stitle">Allergy <span class="ac">Detection</span></h1>
    <p class="ssub">Cross-reference allergies with foods, medications, and environmental triggers — populated from your medical report data.</p>
  </div>
  <!-- Report-based allergy notice -->
  <div class="gc" style="padding:18px 22px;margin-bottom:20px;background:rgba(0,212,170,.06);border-color:rgba(0,212,170,.3)">
    <div style="display:flex;align-items:center;gap:12px">
      <span style="font-size:20px">📋</span>
      <div>
        <div style="font-family:var(--fd);font-size:10px;letter-spacing:1.5px;color:var(--teal);text-transform:uppercase;margin-bottom:3px">Report-Synced Allergens</div>
        <div style="font-size:12.5px;color:var(--txt2)">Allergens listed below are populated based on data from your submitted medical reports. Submit a profile in the Advisor tab to personalize this list.</div>
      </div>
    </div>
  </div>
  <div class="asb">
    <input class="fi" id="asrch" type="text" placeholder="Search allergens, medications, foods..." style="flex:1">
    <button class="btn bp" onclick="filterAllergy()">🔍 Search</button>
  </div>
  <div class="afc">
    <button class="fch act" data-f="all" onclick="setAFilter(this,'all')">All</button>
    <button class="fch" data-f="food" onclick="setAFilter(this,'food')">🍎 Food</button>
    <button class="fch" data-f="medicine" onclick="setAFilter(this,'medicine')">💊 Medicine</button>
    <button class="fch" data-f="environment" onclick="setAFilter(this,'environment')">🌿 Environment</button>
  </div>
  <div class="gc" style="padding:0;overflow:hidden;margin-bottom:28px">
    <div style="padding:18px 22px;border-bottom:1px solid var(--border);font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--teal)">Allergen Database</div>
    <div class="atw"><table class="at">
      <thead><tr><th>Allergen</th><th>Category</th><th>Severity</th><th>Known Interactions</th><th>Risk</th></tr></thead>
      <tbody id="atb"></tbody>
    </table></div>
  </div>

  <!-- Medicine Safety Check — moved to Analyzer -->
  <div class="nd"></div>
  <div style="margin-bottom:28px">
    <div class="gc" style="padding:28px;background:rgba(0,245,255,.04);border-color:rgba(0,245,255,.2);display:flex;align-items:center;gap:18px">
      <span style="font-size:36px">🔬</span>
      <div style="flex:1">
        <div style="font-family:var(--fd);font-size:11px;letter-spacing:2px;text-transform:uppercase;color:var(--cyan);margin-bottom:6px">Drug Suitability Analyzer</div>
        <p style="font-size:13px;color:var(--txt2);margin-bottom:14px">The Drug Suitability Analyzer has been moved to its own dedicated section for a more comprehensive analysis experience.</p>
        <button class="btn bp" onclick="goPage('analyzer')" style="padding:10px 20px">⚡ Open Analyzer →</button>
      </div>
    </div>
  </div>

  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;padding-bottom:56px">
    <div class="gc" style="padding:26px">
      <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--red);margin-bottom:18px">🚨 Critical Interaction Alerts</div>
      <div id="ialerts"></div>
    </div>
    <div class="gc" style="padding:26px">
      <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--teal);margin-bottom:18px">Severity Color Guide</div>
      <div style="display:flex;flex-direction:column;gap:14px">
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bh">High Risk</span><span style="font-size:12.5px;color:var(--txt2)">Potentially life-threatening</span></div><div class="sb"><div class="sf high"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Anaphylaxis possible. Carry EpiPen.</p></div>
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bm">Moderate</span><span style="font-size:12.5px;color:var(--txt2)">Significant risk</span></div><div class="sb"><div class="sf mod"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Hives, swelling, or respiratory irritation.</p></div>
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bl">Low Risk</span><span style="font-size:12.5px;color:var(--txt2)">Mild reaction</span></div><div class="sb"><div class="sf low"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Minor discomfort such as itching.</p></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ══════════ ANALYZER PAGE ══════════ -->
<div class="page" id="page-analyzer">
<div class="wrap">
  <div style="padding:36px 0 20px">
    <div class="stag">🔬 Drug Safety Intelligence</div>
    <h1 class="stitle">Drug Suitability <span class="ac">Analyzer</span></h1>
    <p class="ssub">Check if a medicine is safe based on your allergy profile, current conditions, and medication history.</p>
  </div>
  <div class="analyzer-grid">
    <div class="gc" style="padding:26px">
      <div class="stag2">Check Medicine Safety</div>
      <div style="display:flex;flex-direction:column;gap:14px">
        <div class="fg">
          <label class="fl">Medicine Name</label>
          <input class="fi" id="medchk-name" type="text" placeholder="e.g. Ibuprofen, Amoxicillin, Warfarin">
        </div>
        <div class="fg">
          <label class="fl">Patient Allergies (from report or enter)</label>
          <input class="fi" id="medchk-allergy" type="text" placeholder="e.g. Penicillin, Aspirin, Sulfa, Shellfish">
        </div>
        <div class="fg">
          <label class="fl">Current Conditions</label>
          <input class="fi" id="medchk-conditions" type="text" placeholder="e.g. Hypertension, Diabetes, Kidney disease">
        </div>
        <div class="fg">
          <label class="fl">Current Medications</label>
          <input class="fi" id="medchk-meds" type="text" placeholder="e.g. Metformin, Losartan, Aspirin">
        </div>
        <button class="btn bp" onclick="checkMedSafety()" style="justify-content:center">🔬 Analyze Drug Safety</button>
      </div>
    </div>
    <div class="gc medcheck-result analyzer-result-panel" id="medchk-result">
      <div id="medchk-content">
        <div style="text-align:center;padding:40px 20px;color:var(--dim)">
          <div style="font-size:44px;margin-bottom:14px;opacity:.3">💊</div>
          <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase">Enter a medicine to begin analysis</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick reference panels -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;padding-bottom:56px">
    <div class="gc" style="padding:26px">
      <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--red);margin-bottom:18px">🚨 Critical Interaction Alerts</div>
      <div id="ialerts"></div>
    </div>
    <div class="gc" style="padding:26px">
      <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--teal);margin-bottom:18px">Severity Color Guide</div>
      <div style="display:flex;flex-direction:column;gap:14px">
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bh">High Risk</span><span style="font-size:12.5px;color:var(--txt2)">Potentially life-threatening</span></div><div class="sb"><div class="sf high"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Anaphylaxis possible. Carry EpiPen.</p></div>
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bm">Moderate</span><span style="font-size:12.5px;color:var(--txt2)">Significant risk</span></div><div class="sb"><div class="sf mod"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Hives, swelling, or respiratory irritation.</p></div>
        <div><div style="display:flex;align-items:center;gap:10px;margin-bottom:6px"><span class="badge bl">Low Risk</span><span style="font-size:12.5px;color:var(--txt2)">Mild reaction</span></div><div class="sb"><div class="sf low"></div></div><p style="font-size:11.5px;color:var(--dim);margin-top:5px">Minor discomfort such as itching.</p></div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ══════════ CONSULT CORNER PAGE ══════════ -->
<div class="page" id="page-consult">
<div class="wrap">
  <div style="padding:36px 0 20px">
    <div class="stag">🩺 Telehealth Platform</div>
    <h1 class="stitle">Consult <span class="ac">Corner</span></h1>
    <p class="ssub">AI-powered symptom checker with telemedicine access. Get instant insights and connect with doctors.</p>
  </div>
  <div class="consult-grid">
    <!-- Symptom Checker -->
    <div>
      <div class="gc" style="padding:28px;margin-bottom:20px">
        <div class="stag2" style="margin-bottom:16px">🔍 Symptom Checker</div>
        <div class="fg" style="margin-bottom:14px">
          <label class="fl">Describe Your Symptoms</label>
          <textarea class="fta" id="symptom-input" style="min-height:100px" placeholder="e.g. I have a persistent headache, slight fever, and feel dizzy when standing up..."></textarea>
        </div>
        <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px">
          <span style="font-family:var(--fd);font-size:9px;letter-spacing:1px;color:var(--dim);text-transform:uppercase;width:100%;margin-bottom:4px">Quick Add:</span>
          <button class="fch" onclick="appendSymptom('Fever')">🌡 Fever</button>
          <button class="fch" onclick="appendSymptom('Headache')">🤕 Headache</button>
          <button class="fch" onclick="appendSymptom('Fatigue')">😴 Fatigue</button>
          <button class="fch" onclick="appendSymptom('Nausea')">🤢 Nausea</button>
          <button class="fch" onclick="appendSymptom('Chest Pain')">💔 Chest Pain</button>
          <button class="fch" onclick="appendSymptom('Shortness of Breath')">😮‍💨 Breathlessness</button>
        </div>
        <button class="btn bp" onclick="analyzeSymptoms()" style="width:100%;justify-content:center">
          <span id="consult-spin" style="display:none;width:16px;height:16px;border:2px solid rgba(0,245,255,.3);border-top-color:var(--cyan);border-radius:50%;animation:spin .8s linear infinite"></span>
          🧠 Analyze Symptoms
        </button>
      </div>

      <!-- Results -->
      <div class="gc consult-result" id="consult-result" style="padding:28px">
        <div id="consult-output"></div>
      </div>
    </div>

    <!-- Right column -->
    <div class="consult-right">
      <!-- Telehealth Connect -->
      <div class="gc" style="padding:26px">
        <div class="stag2">📞 Telehealth Connect</div>
        <p style="font-size:12.5px;color:var(--txt2);margin-bottom:14px;line-height:1.7">Connect instantly with a certified doctor for a real-time consultation.</p>
        <div class="telehealth-btns">
          <div class="tele-btn video" onclick="appointDoctor('video')">
            <div class="tele-icon">📹</div>
            <div class="tele-label" style="color:var(--cyan)">Video Call</div>
            <div class="tele-sub">Appoint a Doctor</div>
          </div>
          <div class="tele-btn audio" onclick="appointDoctor('audio')">
            <div class="tele-icon">📞</div>
            <div class="tele-label" style="color:var(--teal)">Audio Call</div>
            <div class="tele-sub">Appoint a Doctor</div>
          </div>
        </div>
      </div>

      <!-- Available Doctors -->
      <div class="gc" style="padding:26px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <div class="stag2" style="margin-bottom:0">Available Doctors</div>
          <span class="badge bl">3 Online</span>
        </div>
        <div class="doc-card">
          <div class="doc-avatar">👨‍⚕️</div>
          <div class="doc-info">
            <div class="doc-name">Dr. Arjun Sharma</div>
            <div class="doc-spec">General Physician · MBBS, MD</div>
            <div class="doc-status">Available Now</div>
          </div>
          <button class="btn bp" style="padding:8px 14px;font-size:8.5px" onclick="appointDoctor('video')">Book</button>
        </div>
        <div class="doc-card">
          <div class="doc-avatar">👩‍⚕️</div>
          <div class="doc-info">
            <div class="doc-name">Dr. Priya Nair</div>
            <div class="doc-spec">Internal Medicine · MD, FACP</div>
            <div class="doc-status">Available Now</div>
          </div>
          <button class="btn bp" style="padding:8px 14px;font-size:8.5px" onclick="appointDoctor('audio')">Book</button>
        </div>
        <div class="doc-card">
          <div class="doc-avatar">👨‍⚕️</div>
          <div class="doc-info">
            <div class="doc-name">Dr. Rahul Mehta</div>
            <div class="doc-spec">Cardiologist · DM, FSCAI</div>
            <div class="doc-status">Available Now</div>
          </div>
          <button class="btn bp" style="padding:8px 14px;font-size:8.5px" onclick="appointDoctor('video')">Book</button>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="gc" style="padding:22px">
        <div class="stag2">Platform Stats</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:4px">
          <div style="text-align:center;padding:12px;border:1px solid var(--border);border-radius:8px;background:rgba(0,20,40,.4)">
            <div style="font-family:var(--fd);font-size:22px;font-weight:700;color:var(--cyan)">2min</div>
            <div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:3px">Avg Wait Time</div>
          </div>
          <div style="text-align:center;padding:12px;border:1px solid var(--border);border-radius:8px;background:rgba(0,20,40,.4)">
            <div style="font-family:var(--fd);font-size:22px;font-weight:700;color:var(--teal)">24/7</div>
            <div style="font-size:10px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:3px">Availability</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>

<!-- ══════════ DASHBOARD PAGE ══════════ -->
<div class="page" id="page-dash">
<div class="wrap">
  <div style="padding:36px 0 20px;display:flex;justify-content:space-between;align-items:flex-end;flex-wrap:wrap;gap:14px">
    <div>
      <div class="stag">📊 Analytics Interface</div>
      <h1 class="stitle">Medical History <span class="ac">Dashboard</span></h1>
      <p class="ssub">Track CBC health trends and review past analyses.</p>
    </div>
    <button class="btn bp" onclick="dlReport()">📄 Download Report</button>
  </div>
  <div class="dsg">
    <div class="gc dsc fi2"><div class="dsi">📋</div><div class="dsv" id="dtot">12</div><div class="dsl">Total Analyses</div></div>
    <div class="gc dsc fi2"><div class="dsi">⚠️</div><div class="dsv" style="color:var(--orange)">3</div><div class="dsl">Alerts Flagged</div></div>
    <div class="gc dsc fi2"><div class="dsi">💊</div><div class="dsv" style="color:var(--teal)">5</div><div class="dsl">Active Meds</div></div>
    <div class="gc dsc fi2"><div class="dsi">✅</div><div class="dsv" style="color:var(--green)">9</div><div class="dsl">Clear Results</div></div>
  </div>
  <div class="cr">
    <div class="gc cc"><h3>WBC & Platelet Trend</h3><div class="ccon"><canvas id="cline"></canvas></div></div>
    <div class="gc cc">
      <h3>Allergic Reaction Risk Distribution</h3>
      <div style="display:grid;grid-template-columns:1.2fr 1fr;gap:14px;align-items:center">
        <div class="ccon" style="height:180px"><canvas id="cdough"></canvas></div>
        <div>
          <div style="font-family:var(--fd);font-size:8.5px;letter-spacing:1.5px;text-transform:uppercase;color:var(--dim);margin-bottom:12px">Risk Legend</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-bottom:14px">
            <div style="display:flex;align-items:center;gap:8px"><div style="width:10px;height:10px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green);flex-shrink:0"></div><div><div style="font-family:var(--fd);font-size:9px;color:var(--green)">Low Risk — 58%</div><div style="font-size:10.5px;color:var(--dim)">Mild or no reactions expected</div></div></div>
            <div style="display:flex;align-items:center;gap:8px"><div style="width:10px;height:10px;border-radius:50%;background:var(--orange);box-shadow:0 0 6px var(--orange);flex-shrink:0"></div><div><div style="font-family:var(--fd);font-size:9px;color:var(--orange)">Moderate — 30%</div><div style="font-size:10.5px;color:var(--dim)">Hives, swelling, monitored reactions</div></div></div>
            <div style="display:flex;align-items:center;gap:8px"><div style="width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 6px var(--red);flex-shrink:0"></div><div><div style="font-family:var(--fd);font-size:9px;color:var(--red)">High Risk — 12%</div><div style="font-size:10.5px;color:var(--dim)">Anaphylaxis risk, immediate care</div></div></div>
          </div>
          <div style="padding:10px 12px;border-radius:8px;background:rgba(0,20,40,.5);border:1px solid var(--border);font-size:11px;color:var(--txt2);line-height:1.6">Based on your last <strong style="color:var(--cyan)">12 scans</strong>. Most entries fall in the safe zone. 1 high-risk allergen flagged.</div>
        </div>
      </div>
    </div>
  </div>
  <!-- CBC Trend Charts -->
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
    <div class="gc cc"><h3>Hemoglobin Trend</h3><div class="ccon"><canvas id="chgb"></canvas></div></div>
    <div class="gc cc"><h3>RBC Count Trend</h3><div class="ccon"><canvas id="crbc"></canvas></div></div>
  </div>
  <div class="gc" style="padding:26px;margin-bottom:28px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:18px">
      <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--txt2)">Recent Analysis History</div>
      <button class="btn bs" onclick="clearHist()" style="padding:6px 14px;font-size:9px">Clear</button>
    </div>
    <div id="hlist"></div>
  </div>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding-bottom:56px">
    <div class="gc fi2" style="padding:22px"><div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:10px">WBC Count</div><div style="font-family:var(--fd);font-size:26px;font-weight:700;color:var(--cyan)">7.2 ×10³/µL</div><div style="font-size:11.5px;color:var(--txt2);margin-top:3px">Normal range · Last recorded</div><div class="sb" style="margin-top:10px"><div class="sf low"></div></div><span class="badge bl" style="margin-top:7px;display:inline-block">Normal</span></div>
    <div class="gc fi2" style="padding:22px"><div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:10px">Platelet Count</div><div style="font-family:var(--fd);font-size:26px;font-weight:700;color:var(--orange)">98 ×10³/µL</div><div style="font-size:11.5px;color:var(--txt2);margin-top:3px">Below normal — monitor closely</div><div class="sb" style="margin-top:10px"><div class="sf high"></div></div><span class="badge bh" style="margin-top:7px;display:inline-block">Low</span></div>
    <div class="gc fi2" style="padding:22px"><div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;text-transform:uppercase;color:var(--dim);margin-bottom:10px">Hemoglobin</div><div style="font-family:var(--fd);font-size:26px;font-weight:700;color:var(--green)">13.4 g/dL</div><div style="font-size:11.5px;color:var(--txt2);margin-top:3px">Within normal range</div><div class="sb" style="margin-top:10px"><div class="sf low" style="width:74%"></div></div><span class="badge bl" style="margin-top:7px;display:inline-block">Good</span></div>
  </div>
</div>
</div>

<!-- ══════════ FOOD PAGE ══════════ -->
<div class="page" id="page-food">
<div class="wrap">
  <div style="padding:36px 0 20px">
    <div class="stag">🥗 Nutritional Intelligence</div>
    <h1 class="stitle">Food <span class="ac">Recommendation</span></h1>
    <p class="ssub" data-i18n="nutritionSub">Personalized dietary guidance based on your medical condition.</p>
  </div>

  <!-- Free text condition input -->
  <div class="nutr-input-wrap">
    <div class="nutr-input-row" style="margin-bottom:14px">
      <div class="fg">
        <label class="fl">Enter Your Condition</label>
        <input class="fi" id="condInput" type="text" placeholder="e.g. Diabetes, Hypertension, Anemia, PCOS, Thyroid disorder...">
      </div>
      <button class="btn bp" onclick="fetchFoodRec()" style="flex-shrink:0">🔍 Get Recommendations</button>
    </div>
    <div style="font-family:var(--fd);font-size:9px;letter-spacing:1px;color:var(--dim);text-transform:uppercase;margin-bottom:8px">Or select a common condition:</div>
    <div class="cs" style="margin-bottom:0">
      <button class="cp" data-c="diabetes" onclick="quickFood(this,'diabetes')"><span class="cpi">🩸</span>Diabetes</button>
      <button class="cp" data-c="hypertension" onclick="quickFood(this,'hypertension')"><span class="cpi">❤️</span>Hypertension</button>
      <button class="cp" data-c="anemia" onclick="quickFood(this,'anemia')"><span class="cpi">🔬</span>Anemia</button>
      <button class="cp" data-c="allergy" onclick="quickFood(this,'allergy')"><span class="cpi">🌿</span>Allergies</button>
      <button class="cp" data-c="thyroid" onclick="quickFood(this,'thyroid')"><span class="cpi">🦋</span>Thyroid</button>
      <button class="cp" data-c="pcos" onclick="quickFood(this,'pcos')"><span class="cpi">⚕️</span>PCOS</button>
    </div>
  </div>

  <div class="food-loading" id="foodLoading"><div class="food-loading-spin"></div>Generating recommendations...</div>

  <div class="fr2" id="foodResults">
    <div class="gc fc2">
      <div class="fch2"><div class="fci">✅</div><div><div class="fct">Recommended Foods</div><div class="fcs">Beneficial for your condition</div></div></div>
      <div id="feat"><div style="font-size:12.5px;color:var(--dim);font-style:italic;padding:14px 0">Enter a condition above to see recommendations</div></div>
    </div>
    <div class="gc fc2">
      <div class="fch2"><div class="fci">⛔</div><div><div class="fct">Foods to Avoid</div><div class="fcs">May worsen your condition</div></div></div>
      <div id="favd"><div style="font-size:12.5px;color:var(--dim);font-style:italic;padding:14px 0">Enter a condition above to see recommendations</div></div>
    </div>
  </div>
  <div class="nd"></div>
  <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:18px;padding-bottom:56px">
    <div class="gc fi2" style="padding:26px"><div style="font-size:30px;margin-bottom:14px">💧</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:9px">Stay Hydrated</div><p style="font-size:12.5px;color:var(--txt2);line-height:1.7">Aim for 8–10 glasses of water daily. Dehydration affects medication absorption.</p></div>
    <div class="gc fi2" style="padding:26px"><div style="font-size:30px;margin-bottom:14px">🕐</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:9px">Meal Timing</div><p style="font-size:12.5px;color:var(--txt2);line-height:1.7">Take medications consistently. Some drugs work best on an empty stomach, others with food.</p></div>
    <div class="gc fi2" style="padding:26px"><div style="font-size:30px;margin-bottom:14px">🧬</div><div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan);margin-bottom:9px">Personalization</div><p style="font-size:12.5px;color:var(--txt2);line-height:1.7">Your microbiome influences which foods benefit you most. Track responses carefully.</p></div>
  </div>
</div>
</div>

<!-- ══════════ TELEHEALTH — CONSULT DOCTOR ══════════ -->
<div class="page" id="page-telehealth">
<div class="wrap">
  <div class="region-hero">
    <div class="stag">📍 Location & Triage</div>
    <h1 class="stitle">Find Your <span class="ac">Doctor</span></h1>
    <p class="ssub" style="margin:0 auto;text-align:center">Connect with verified doctors in your region. AI-assisted triage to the right care level.</p>
  </div>

  <!-- Region Selector -->
  <div id="region-form"></div>

  <!-- Triage System -->
  <div class="nd"></div>
  <div style="margin-bottom:14px">
    <div class="stag">🧠 AI Triage Assessment</div>
    <h2 class="stitle" style="font-size:clamp(18px,2.5vw,30px)">Select Your <span class="ac">Case Level</span></h2>
  </div>
  <div class="triage-grid">
    <div class="triage-card easy" data-level="easy" onclick="selectTriage('easy')">
      <div class="triage-level">🟢</div>
      <div class="triage-title">LEVEL 1 — EASY</div>
      <div class="triage-sub">Minor symptoms solvable via video consultation. No physical visit required.</div>
      <div class="triage-price">Video Call: ₹250 &nbsp;|&nbsp; App Commission: ₹50</div>
      <div class="triage-features">
        <div class="tf">Instant video call booking</div>
        <div class="tf">AI symptom summary to doctor</div>
        <div class="tf">Digital prescription upload</div>
        <div class="tf">Doctor receives ₹200</div>
      </div>
    </div>
    <div class="triage-card moderate" data-level="moderate" onclick="selectTriage('moderate')">
      <div class="triage-level">🟡</div>
      <div class="triage-title">LEVEL 2 — MODERATE</div>
      <div class="triage-sub">Requires physical checkup, lab tests or practical examination needed.</div>
      <div class="triage-price">Visit: ₹500–600 &nbsp;|&nbsp; Commission: ₹100</div>
      <div class="triage-features">
        <div class="tf">In-person appointment scheduling</div>
        <div class="tf">Time slot booking system</div>
        <div class="tf">QR check-in at clinic</div>
        <div class="tf">Doctor receives ₹400–500</div>
      </div>
    </div>
    <div class="triage-card critical" data-level="critical" onclick="selectTriage('critical')">
      <div class="triage-level">🔴</div>
      <div class="triage-title">LEVEL 3 — CRITICAL</div>
      <div class="triage-sub">Life-threatening condition requiring immediate hospitalization.</div>
      <div class="triage-price">Emergency — Immediate Response</div>
      <div class="triage-features">
        <div class="tf">Auto-select nearest hospital</div>
        <div class="tf">Auto-dispatch ambulance</div>
        <div class="tf">Live GPS to family</div>
        <div class="tf">Emergency contact SMS</div>
      </div>
    </div>
  </div>

  <!-- Doctors -->
  <div class="nd"></div>
  <div class="doctors-section">
    <div class="stag">🩺 Available Doctors</div>
    <h2 class="stitle" style="font-size:clamp(18px,2.5vw,30px)">Verified <span class="ac">Specialists</span></h2>
    <div id="doctors-grid" class="doctor-grid"></div>
  </div>

  <div style="height:56px"></div>
</div>
</div>

<!-- ══════════ EMERGENCY PAGE ══════════ -->
<div class="page" id="page-emergency">
<div class="wrap">
  <div class="emergency-hero">
    <div class="stag" style="color:var(--red)">🚨 Critical Response System</div>
    <h1 class="stitle">Emergency <span style="color:var(--red);text-shadow:0 0 18px rgba(255,45,85,.5)">Response</span></h1>
    <p class="ssub" style="margin:0 auto;text-align:center">Immediate AI-powered emergency detection and automated hospital + ambulance dispatch.</p>
    <div class="emergency-pulse" style="position:relative;height:120px;margin:20px 0">
      <div class="ep-ring"></div>
      <div class="ep-ring"></div>
      <div class="ep-ring"></div>
      <button class="ep-btn" onclick="triggerEmergencyAlert('Manual Emergency Call')">🆘</button>
    </div>
    <p style="font-family:var(--fd);font-size:9.5px;letter-spacing:3px;color:var(--dim);text-transform:uppercase">Tap for instant emergency dispatch</p>
  </div>

  <div class="emg-grid">
    <!-- Critical Symptoms -->
    <div class="emg-card">
      <div class="emg-title"><span>⚠️</span> Select Critical Symptoms</div>
      <p style="font-size:12px;color:var(--txt2);line-height:1.6;margin-bottom:14px">Select any symptoms you're experiencing. If critical, emergency will be automatically triggered.</p>
      <div id="critical-symptoms-list" class="critical-symptoms"></div>
    </div>
    <!-- Emergency Actions -->
    <div style="display:flex;flex-direction:column;gap:14px">
      <div class="emg-card">
        <div class="emg-title"><span>🚑</span> Quick Actions</div>
        <div class="emg-actions">
          <button class="emg-action-btn red" onclick="callAmbulance()"><span>🚑</span> Call Ambulance Now</button>
          <button class="emg-action-btn blue" onclick="callNearestHospital()"><span>🏥</span> Call Nearest Hospital</button>
          <button class="emg-action-btn green" onclick="notifyContact()"><span>📱</span> Notify Emergency Contact</button>
          <button class="emg-action-btn green" onclick="shareGPS()"><span>📍</span> Share Live GPS Location</button>
        </div>
      </div>
      <!-- Nearby Hospitals -->
      <div class="emg-card">
        <div class="emg-title"><span>🏥</span> Nearby Hospitals</div>
        <div id="nearby-hospitals" class="hospital-list"></div>
      </div>
    </div>
  </div>

  <!-- Ambulance Tracker (hidden until triggered) -->
  <div id="amb-tracker-section" style="display:none;margin-bottom:28px">
    <div class="ambulance-tracker">
      <div class="emg-title" style="color:var(--red)"><span>🚑</span> Live Ambulance Tracking</div>
      <div style="font-size:12px;color:var(--txt2);margin-bottom:14px">ETA: <strong style="color:var(--cyan);font-family:var(--fd)">~8 minutes</strong> · Driver: Ramesh Kumar · Reg: WB-01-9234</div>
      <div class="tracker-map">
        <div class="amb-dot" style="left:20%;top:60%"></div>
        <span style="font-family:var(--fd);font-size:10px;letter-spacing:2px;color:var(--txt2);z-index:1">LIVE MAP TRACKING</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px">
        <div style="text-align:center;padding:12px;border-radius:8px;border:1px solid var(--border);background:rgba(0,20,40,.4)">
          <div style="font-family:var(--fd);font-size:18px;color:var(--red)">8</div>
          <div style="font-size:10px;color:var(--dim);letter-spacing:1px">MIN ETA</div>
        </div>
        <div style="text-align:center;padding:12px;border-radius:8px;border:1px solid var(--border);background:rgba(0,20,40,.4)">
          <div style="font-family:var(--fd);font-size:18px;color:var(--cyan)">2.3</div>
          <div style="font-size:10px;color:var(--dim);letter-spacing:1px">KM AWAY</div>
        </div>
        <div style="text-align:center;padding:12px;border-radius:8px;border:1px solid var(--border);background:rgba(0,20,40,.4)">
          <div style="font-family:var(--fd);font-size:18px;color:var(--green)">✓</div>
          <div style="font-size:10px;color:var(--dim);letter-spacing:1px">BED RESERVED</div>
        </div>
      </div>
    </div>
  </div>

  <div style="height:56px"></div>
</div>
</div>

<!-- ══════════ APPOINTMENTS PAGE ══════════ -->
<div class="page" id="page-appointments">
<div class="wrap" style="padding-top:20px">
  <div style="padding:24px 0 16px">
    <div class="stag">📅 Appointment Manager</div>
    <h1 class="stitle">My <span class="ac">Appointments</span></h1>
  </div>

  <div class="appt-tabs">
    <button class="appt-tab active" onclick="filterAppts('all',this)">All</button>
    <button class="appt-tab" onclick="filterAppts('upcoming',this)">Upcoming</button>
    <button class="appt-tab" onclick="filterAppts('completed',this)">Completed</button>
    <button class="appt-tab" onclick="filterAppts('cancelled',this)">Cancelled</button>
  </div>

  <div id="appt-list" class="appt-list"></div>

  <div class="nd"></div>

  <!-- Book New Appointment -->
  <div id="new-appt-section">
    <div class="stag">📋 Book New Appointment</div>
    <h2 class="stitle" style="font-size:clamp(18px,2.2vw,26px)">Schedule a <span class="ac">Visit</span></h2>
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-top:20px">
      <div class="gc" style="padding:26px">
        <div class="stag2">Appointment Details</div>
        <div class="fg" style="margin-bottom:14px">
          <label class="fl">Select Doctor</label>
          <select class="fs" id="appt-doctor-sel">
            <option value="">Choose a doctor...</option>
            <option>Dr. Priya Sharma — General Physician</option>
            <option>Dr. Rahul Mehta — Cardiologist</option>
            <option>Dr. Sunita Rao — Pediatrician</option>
            <option>Dr. Aditya Kumar — Orthopedic</option>
          </select>
        </div>
        <div class="fg" style="margin-bottom:14px">
          <label class="fl">Appointment Type</label>
          <select class="fs" id="appt-type-sel">
            <option value="video">📹 Video Call — ₹250</option>
            <option value="visit">🏥 Physical Visit — ₹500</option>
          </select>
        </div>
        <div class="fg" style="margin-bottom:14px">
          <label class="fl">Preferred Date</label>
          <input class="fi" type="date" id="appt-date" min="2026-02-27">
        </div>
        <div class="fg" style="margin-bottom:18px">
          <label class="fl">Select Time Slot</label>
          <div class="book-slot-grid">
            <button class="time-slot" onclick="selectSlot(this)">9:00 AM</button>
            <button class="time-slot" onclick="selectSlot(this)">9:30 AM</button>
            <button class="time-slot taken">10:00 AM</button>
            <button class="time-slot" onclick="selectSlot(this)">10:30 AM</button>
            <button class="time-slot" onclick="selectSlot(this)">11:00 AM</button>
            <button class="time-slot taken">11:30 AM</button>
            <button class="time-slot" onclick="selectSlot(this)">2:00 PM</button>
            <button class="time-slot" onclick="selectSlot(this)">2:30 PM</button>
            <button class="time-slot" onclick="selectSlot(this)">3:00 PM</button>
            <button class="time-slot taken">3:30 PM</button>
            <button class="time-slot" onclick="selectSlot(this)">4:00 PM</button>
            <button class="time-slot" onclick="selectSlot(this)">4:30 PM</button>
          </div>
        </div>
        <button class="btn bp" style="width:100%;justify-content:center" onclick="bookNewAppointment()">✓ Confirm Appointment</button>
      </div>
      <div class="gc" style="padding:26px">
        <div class="stag2" style="margin-bottom:18px">QR Check-in Code</div>
        <div class="qr-box">
          <div class="qr-code"></div>
          <div style="font-family:var(--fd);font-size:10px;letter-spacing:2px;color:var(--cyan)">SCAN AT CLINIC</div>
          <div style="font-size:11px;color:var(--txt2);text-align:center">Show this QR code at reception for instant check-in. Valid for your upcoming appointments.</div>
        </div>
        <div style="margin-top:20px;padding:16px;border-radius:10px;background:rgba(0,20,40,.5);border:1px solid var(--border)">
          <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--teal);margin-bottom:10px">COMMISSION SPLIT</div>
          <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0;border-bottom:1px solid rgba(0,100,150,.1)"><span style="color:var(--txt2)">You Pay</span><span style="color:var(--cyan);font-family:var(--fd)">₹500</span></div>
          <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0;border-bottom:1px solid rgba(0,100,150,.1)"><span style="color:var(--txt2)">App Commission</span><span style="color:var(--orange);font-family:var(--fd)">₹100</span></div>
          <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0"><span style="color:var(--txt2)">Doctor Receives</span><span style="color:var(--green);font-family:var(--fd)">₹400</span></div>
        </div>
      </div>
    </div>
  </div>

  <div style="height:56px"></div>
</div>
</div>

<!-- ══════════ BILLING PAGE ══════════ -->
<div class="page" id="page-billing">
<div class="wrap" style="padding-top:20px">
  <div style="padding:24px 0 16px">
    <div class="stag">💰 Payment & Revenue</div>
    <h1 class="stitle">Billing & <span class="ac">Wallet</span></h1>
  </div>

  <div class="billing-grid">
    <div>
      <!-- Wallet -->
      <div class="wallet-card" style="margin-bottom:20px">
        <div class="wallet-label">VITREOS WALLET BALANCE</div>
        <div class="wallet-balance" id="wallet-balance">₹1,850</div>
        <div class="wallet-actions">
          <button class="w-btn" onclick="document.getElementById('topup-section').style.display='block'">+ Add Funds</button>
          <button class="w-btn" style="background:rgba(0,212,170,.08);border-color:var(--teal);color:var(--teal)">↑ Withdraw</button>
        </div>
      </div>

      <!-- Top-up -->
      <div id="topup-section" style="display:none;margin-bottom:20px">
        <div class="gc" style="padding:22px">
          <div class="stag2">Add Funds to Wallet</div>
          <div class="fg" style="margin-bottom:14px">
            <label class="fl">Amount (₹)</label>
            <input class="fi" type="number" id="topup-amount" placeholder="Enter amount" min="10">
          </div>
          <div class="stag2" style="margin-bottom:10px">Payment Method</div>
          <div class="payment-methods">
            <div class="pay-method selected" onclick="selectPayMethod('upi',this)">
              <span class="pay-icon">📱</span>
              <div><div class="pay-name">UPI</div><div class="pay-sub">PhonePe, GPay, Paytm</div></div>
              <div class="pay-check">✓</div>
            </div>
            <div class="pay-method" onclick="selectPayMethod('razorpay',this)">
              <span class="pay-icon">💳</span>
              <div><div class="pay-name">Razorpay</div><div class="pay-sub">Credit / Debit Card</div></div>
              <div class="pay-check"></div>
            </div>
            <div class="pay-method" onclick="selectPayMethod('stripe',this)">
              <span class="pay-icon">🌐</span>
              <div><div class="pay-name">Stripe</div><div class="pay-sub">International payments</div></div>
              <div class="pay-check"></div>
            </div>
          </div>
          <button class="btn bp" style="width:100%;justify-content:center;margin-top:16px" onclick="addFunds()">💰 Add Funds</button>
        </div>
      </div>

      <!-- Transactions -->
      <div class="gc" style="padding:22px">
        <div class="stag2" style="margin-bottom:16px">Transaction History</div>
        <div id="txn-list" class="txn-list"></div>
      </div>
    </div>
    <div>
      <!-- Commission Breakdown -->
      <div class="gc commission-breakdown">
        <div class="stag2">Revenue Breakdown</div>
        <div class="commission-row"><span class="label">Total Consultations</span><span class="value">62</span></div>
        <div class="commission-row"><span class="label">Video Calls (×48)</span><span class="value">₹12,000</span></div>
        <div class="commission-row"><span class="label">Physical Visits (×14)</span><span class="value">₹7,000</span></div>
        <div class="commission-row"><span class="label">Emergency Cases (×0)</span><span class="value">₹0</span></div>
        <div class="commission-row"><span class="label">App Commission (20%)</span><span class="value" style="color:var(--orange)">₹3,800</span></div>
        <div class="commission-row"><span class="label" style="color:var(--txt);font-weight:700">Total Net Revenue</span><span class="value" style="color:var(--green)">₹15,200</span></div>
      </div>

      <!-- Doctor Earnings Table -->
      <div class="gc" style="padding:22px;margin-top:14px">
        <div class="stag2" style="margin-bottom:14px">Doctor Earnings (This Month)</div>
        <table class="admin-table" style="font-size:11.5px">
          <thead><tr><th>Doctor</th><th>Calls</th><th>Earned</th></tr></thead>
          <tbody>
            <tr><td>Dr. Priya Sharma</td><td>28</td><td style="color:var(--green)">₹5,600</td></tr>
            <tr><td>Dr. Rahul Mehta</td><td>19</td><td style="color:var(--green)">₹3,800</td></tr>
            <tr><td>Dr. Aditya Kumar</td><td>15</td><td style="color:var(--green)">₹3,000</td></tr>
          </tbody>
        </table>
      </div>

      <!-- Security -->
      <div class="gc" style="padding:22px;margin-top:14px">
        <div class="stag2" style="margin-bottom:10px">Security & Compliance</div>
        <div style="display:flex;flex-direction:column;gap:8px">
          <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--txt2)"><span style="color:var(--green)">🔒</span> End-to-end AES-256 encryption</div>
          <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--txt2)"><span style="color:var(--green)">✓</span> HIPAA-compliant data handling</div>
          <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--txt2)"><span style="color:var(--green)">📱</span> OTP + Email 2FA enabled</div>
          <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--txt2)"><span style="color:var(--green)">💳</span> PCI-DSS secure payments</div>
          <div style="display:flex;align-items:center;gap:10px;font-size:12px;color:var(--txt2)"><span style="color:var(--green)">🛡️</span> Auto-split commissions</div>
        </div>
      </div>
    </div>
  </div>

  <div style="height:56px"></div>
</div>
</div>

<!-- ══════════ ADMIN DASHBOARD ══════════ -->
<div class="page" id="page-admindash">
<div class="wrap" style="padding-top:20px">
  <div class="admin-header">
    <div>
      <div class="stag">⚙️ Platform Administration</div>
      <h1 class="stitle">Admin <span class="ac">Dashboard</span></h1>
    </div>
    <div style="display:flex;gap:10px">
      <span class="badge bl">System Online</span>
      <span class="badge bi">v2.0.1</span>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="admin-kpi">
    <div class="kpi-card cyan">
      <div class="kpi-icon">📹</div>
      <div class="kpi-val">1,284</div>
      <div class="kpi-lbl">Video Consultations</div>
      <div class="kpi-trend">↑ +18% this month</div>
    </div>
    <div class="kpi-card green">
      <div class="kpi-icon">🏥</div>
      <div class="kpi-val">342</div>
      <div class="kpi-lbl">Physical Visits</div>
      <div class="kpi-trend">↑ +12% this month</div>
    </div>
    <div class="kpi-card orange">
      <div class="kpi-icon">💰</div>
      <div class="kpi-val">₹73,200</div>
      <div class="kpi-lbl">Total Revenue</div>
      <div class="kpi-trend">↑ +24% this month</div>
    </div>
    <div class="kpi-card red">
      <div class="kpi-icon">🚨</div>
      <div class="kpi-val">17</div>
      <div class="kpi-lbl">Critical Cases</div>
      <div class="kpi-trend">↓ -3% this month</div>
    </div>
  </div>

  <!-- Revenue Chart + Region Map -->
  <div class="admin-grid">
    <div class="revenue-chart-wrap">
      <div class="stag2">Monthly Revenue Overview</div>
      <div style="height:220px;position:relative;margin-top:14px">
        <canvas id="admin-revenue-chart"></canvas>
      </div>
    </div>
    <div class="gc" style="padding:22px">
      <div class="stag2" style="margin-bottom:14px">Region-wise Activity</div>
      <div class="region-map">
        <div class="rmap-dot" data-label="Kolkata" style="top:35%;left:55%"></div>
        <div class="rmap-dot" data-label="Mumbai" style="top:55%;left:25%;background:var(--teal);box-shadow:0 0 10px var(--teal)"></div>
        <div class="rmap-dot" data-label="Delhi" style="top:20%;left:38%;background:var(--orange);box-shadow:0 0 10px var(--orange)"></div>
        <div class="rmap-dot" data-label="Chennai" style="top:72%;left:42%;background:var(--green);box-shadow:0 0 10px var(--green)"></div>
        <span style="font-family:var(--fd);font-size:9px;letter-spacing:2px;color:var(--dim);z-index:1;align-self:flex-end;padding:10px">INDIA COVERAGE MAP</span>
      </div>
      <div style="display:flex;flex-direction:column;gap:7px">
        <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Kolkata</span><span style="font-family:var(--fd);color:var(--cyan)">₹28,400</span></div>
        <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Mumbai</span><span style="font-family:var(--fd);color:var(--teal)">₹22,100</span></div>
        <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Delhi</span><span style="font-family:var(--fd);color:var(--orange)">₹14,800</span></div>
        <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Chennai</span><span style="font-family:var(--fd);color:var(--green)">₹7,900</span></div>
      </div>
    </div>
  </div>

  <!-- Doctor Management -->
  <div class="admin-grid" style="margin-top:0">
    <div class="gc" style="padding:22px">
      <div class="stag2" style="margin-bottom:14px">Doctor Performance</div>
      <div style="overflow-x:auto">
        <table class="admin-table">
          <thead><tr><th>Doctor</th><th>Status</th><th>Earnings</th><th>Consults</th><th>Action</th></tr></thead>
          <tbody id="admin-doctor-table"></tbody>
        </table>
      </div>
    </div>
    <div class="gc" style="padding:22px">
      <div class="stag2" style="margin-bottom:14px">Commission Overview</div>
      <div style="display:flex;flex-direction:column;gap:8px">
        <div class="commission-row" style="padding:8px 0"><span class="label">Video Call Commission</span><span class="value">₹50 / call</span></div>
        <div class="commission-row" style="padding:8px 0"><span class="label">Visit Commission</span><span class="value">₹100 / visit</span></div>
        <div class="commission-row" style="padding:8px 0"><span class="label">Total Commissions Earned</span><span class="value">₹14,200</span></div>
        <div class="commission-row" style="padding:8px 0"><span class="label">Pending Payouts</span><span class="value" style="color:var(--orange)">₹8,640</span></div>
        <div style="margin-top:10px">
          <button class="btn bp" style="width:100%;justify-content:center;font-size:9px;padding:10px">Process Payouts</button>
        </div>
      </div>
      <div style="margin-top:20px;padding:14px;border-radius:10px;background:rgba(0,20,40,.5);border:1px solid var(--border)">
        <div class="stag2">Platform Health</div>
        <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
          <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Server Status</span><span class="badge bl" style="font-size:8px">Online</span></div>
          <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Video Service</span><span class="badge bl" style="font-size:8px">Operational</span></div>
          <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">Payment Gateway</span><span class="badge bl" style="font-size:8px">Active</span></div>
          <div style="display:flex;justify-content:space-between;font-size:12px"><span style="color:var(--txt2)">SMS Service</span><span class="badge bl" style="font-size:8px">Active</span></div>
        </div>
      </div>
    </div>
  </div>

  <div style="height:56px"></div>
</div>
</div>

<!-- ══════════ MODALS ══════════ -->

<!-- Payment Before Video Call -->
<div class="modal-overlay" id="payment-modal">
  <div class="modal-box">
    <button class="modal-close" onclick="document.getElementById('payment-modal').classList.remove('open')">×</button>
    <div style="text-align:center;margin-bottom:24px">
      <div style="font-size:40px;margin-bottom:10px">💳</div>
      <div style="font-family:var(--fd);font-size:14px;font-weight:700;color:var(--cyan)">Confirm Payment</div>
      <div id="vc-doctor-name" style="font-size:13px;color:var(--txt2);margin-top:4px"></div>
      <div id="vc-doctor-spec" style="font-size:11px;color:var(--dim)"></div>
    </div>
    <div style="padding:16px;border-radius:10px;background:rgba(0,20,40,.5);border:1px solid var(--border);margin-bottom:20px">
      <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0;border-bottom:1px solid rgba(0,100,150,.1)"><span style="color:var(--txt2)">Video Consultation</span><span style="font-family:var(--fd);color:var(--cyan)">₹250</span></div>
      <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0;border-bottom:1px solid rgba(0,100,150,.1)"><span style="color:var(--txt2)">Platform Fee</span><span style="font-family:var(--fd);color:var(--orange)">₹50</span></div>
      <div style="display:flex;justify-content:space-between;font-size:12px;padding:6px 0"><span style="color:var(--txt2)">Doctor Receives</span><span style="font-family:var(--fd);color:var(--green)">₹200</span></div>
    </div>
    <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--txt2);margin-bottom:10px">Pay from Wallet</div>
    <div style="display:flex;align-items:center;gap:10px;padding:14px;border-radius:10px;background:rgba(0,40,100,.3);border:1px solid var(--borderg);margin-bottom:20px">
      <span style="font-size:20px">💰</span>
      <div><div style="font-size:13px;color:var(--txt)">VITREOS Wallet</div><div style="font-size:11px;color:var(--green);font-family:var(--fd)">Balance: ₹1,850</div></div>
    </div>
    <button class="btn bp" style="width:100%;justify-content:center" onclick="confirmPayment()">💳 Pay ₹250 & Connect</button>
  </div>
</div>

<!-- Video Call UI -->
<div class="modal-overlay" id="video-call-modal">
  <div class="modal-box" style="max-width:640px">
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:18px">
      <div>
        <div style="font-family:var(--fd);font-size:11px;font-weight:700;color:var(--cyan)" id="vc-call-name">Video Consultation</div>
        <div style="font-size:11px;color:var(--txt2);margin-top:2px" id="vc-call-timer">00:00 <span id="vc-timer"></span></div>
      </div>
      <div style="display:flex;align-items:center;gap:8px">
        <div id="vc-status" class="vcam-status"></div>
        <span id="vc-connecting" style="font-family:var(--fd);font-size:9px;color:var(--orange);letter-spacing:1px">CONNECTING...</span>
      </div>
    </div>
    <div class="vcam">
      <div class="vcam-label">Doctor's Camera</div>
      <span style="font-size:64px;z-index:1">👨‍⚕️</span>
    </div>
    <div id="vc-live-ui" style="display:none;flex-direction:column;align-items:center;gap:14px;margin-top:16px">
      <div style="font-size:12px;color:var(--teal);font-family:var(--fd);letter-spacing:1px">● LIVE · Secure E2E Encrypted</div>
      <div class="vc-controls">
        <button class="vc-ctrl" title="Mute">🎙️</button>
        <button class="vc-ctrl" title="Camera">📹</button>
        <button class="vc-ctrl" title="Chat">💬</button>
        <button class="vc-ctrl" title="Screen Share">🖥️</button>
        <button class="vc-ctrl end" onclick="endVideoCall()" title="End Call">📵</button>
      </div>
    </div>
  </div>
</div>

<!-- Post-Call Rating -->
<div class="modal-overlay" id="post-call-modal">
  <div class="modal-box" style="text-align:center">
    <div style="font-size:40px;margin-bottom:14px">⭐</div>
    <div style="font-family:var(--fd);font-size:14px;font-weight:700;color:var(--cyan);margin-bottom:8px">Rate Your Experience</div>
    <div style="font-size:12.5px;color:var(--txt2);margin-bottom:24px">How was your consultation with <span id="post-call-doc">the doctor</span>?</div>
    <div style="display:flex;justify-content:center;gap:12px;margin-bottom:24px">
      <button class="star-btn" onclick="submitRating(1)" style="background:none;border:none;font-size:32px;cursor:pointer;color:var(--dim);transition:var(--tr)">⭐</button>
      <button class="star-btn" onclick="submitRating(2)" style="background:none;border:none;font-size:32px;cursor:pointer;color:var(--dim);transition:var(--tr)">⭐</button>
      <button class="star-btn" onclick="submitRating(3)" style="background:none;border:none;font-size:32px;cursor:pointer;color:var(--dim);transition:var(--tr)">⭐</button>
      <button class="star-btn" onclick="submitRating(4)" style="background:none;border:none;font-size:32px;cursor:pointer;color:var(--dim);transition:var(--tr)">⭐</button>
      <button class="star-btn" onclick="submitRating(5)" style="background:none;border:none;font-size:32px;cursor:pointer;color:var(--dim);transition:var(--tr)">⭐</button>
    </div>
    <textarea class="fta" placeholder="Optional: Share your feedback..." style="margin-bottom:16px"></textarea>
    <button class="btn bp" style="width:100%;justify-content:center" onclick="submitRating(5)">Submit Feedback</button>
  </div>
</div>

<!-- Emergency Alert -->
<div class="emg-alert" id="emergency-alert">
  <div class="emg-alert-box">
    <div class="emg-alert-icon">🚨</div>
    <div class="emg-alert-title">CRITICAL EMERGENCY DETECTED</div>
    <div class="emg-alert-sub">
      <strong style="color:var(--red)" id="alert-symptom">Critical Condition</strong> detected.<br>
      System will automatically:<br>
      <span style="color:var(--cyan)">● Dispatch nearest ambulance</span><br>
      <span style="color:var(--cyan)">● Reserve hospital bed at Apollo Gleneagles</span><br>
      <span style="color:var(--cyan)">● Send SMS to emergency contact</span><br>
      <span style="color:var(--cyan)">● Share live GPS location</span>
    </div>
    <div class="emg-confirm-btns">
      <button class="emg-confirm-btn confirm" onclick="confirmEmergency()">🚑 CONFIRM EMERGENCY</button>
      <button class="emg-confirm-btn cancel" onclick="cancelEmergency()">✕ False Alarm</button>
    </div>
  </div>
</div>

<script>
/* ══ LANGUAGE ══ */
const LANGS={
  en:{flag:'🇬🇧',keys:{bioInterface:'Biological Interface',neuralEngine:'⚕ Neural Analysis Engine',advisorSub:'Enter your medical profile for instant AI-powered drug interaction and reaction analysis.',bloodGroup:'Blood Group',bloodPressure:'Blood Pressure (Systolic)',allergies:'Known Allergies',medications:'Current Medication',dosage:'Dosage',analyzeBtn:'⚡ Analyze Reaction',disclaimer:'⚠ For informational purposes only. Consult a qualified physician.',nutritionSub:'Personalized dietary guidance based on your medical condition.',navAdvisor:'Advisor',navVoice:'Voice',navAllergies:'Allergies',navAnalyzer:'Analyzer',navConsult:'Consult Corner',navDash:'Dashboard',navNutrition:'Nutrition',dashTitle:'Medical History Dashboard',dashSub:'Track CBC health trends and review past analyses.',downloadReport:'📄 Download Report',allergyTitle:'Allergy Detection',allergySub:'Cross-reference allergies with foods, medications, and environmental triggers.',analyzerTitle:'Drug Suitability Analyzer',analyzerSub:'Check if a medicine is safe based on your allergy profile and health data.',consultTitle:'Consult Corner',consultSub:'AI-powered symptom checker with telemedicine access.',foodTitle:'Food Recommendation',voiceTitle:'Voice Medical Assistant',voiceSub:'Speak your symptoms naturally. AI listens, transcribes, and generates real-time medical analysis.'}},
  hi:{flag:'🇮🇳',keys:{bioInterface:'जैविक इंटरफेस',neuralEngine:'⚕ न्यूरल विश्लेषण इंजन',advisorSub:'त्वरित AI-संचालित विश्लेषण के लिए अपनी चिकित्सा प्रोफ़ाइल दर्ज करें।',bloodGroup:'रक्त समूह',bloodPressure:'रक्त चाप (सिस्टोलिक)',allergies:'ज्ञात एलर्जी',medications:'वर्तमान दवाएं',dosage:'खुराक',analyzeBtn:'⚡ प्रतिक्रिया विश्लेषण',disclaimer:'⚠ केवल सूचनात्मक उद्देश्यों के लिए। योग्य चिकित्सक से परामर्श करें।',nutritionSub:'आपकी चिकित्सा स्थिति के आधार पर व्यक्तिगत आहार मार्गदर्शन।',navAdvisor:'सलाहकार',navVoice:'वॉयस',navAllergies:'एलर्जी',navAnalyzer:'विश्लेषक',navConsult:'परामर्श',navDash:'डैशबोर्ड',navNutrition:'पोषण',dashTitle:'चिकित्सा इतिहास डैशबोर्ड',dashSub:'CBC स्वास्थ्य रुझान ट्रैक करें।',downloadReport:'📄 रिपोर्ट डाउनलोड',analyzeBtn:'⚡ प्रतिक्रिया विश्लेषण'}},
  bn:{flag:'🇧🇩',keys:{bioInterface:'জৈবিক ইন্টারফেস',neuralEngine:'⚕ নিউরাল বিশ্লেষণ ইঞ্জিন',advisorSub:'তাৎক্ষণিক AI-চালিত বিশ্লেষণের জন্য আপনার চিকিৎসা প্রোফাইল লিখুন।',bloodGroup:'রক্তের গ্রুপ',bloodPressure:'রক্তচাপ (সিস্টোলিক)',allergies:'পরিচিত অ্যালার্জি',medications:'বর্তমান ওষুধ',dosage:'ডোজ',analyzeBtn:'⚡ প্রতিক্রিয়া বিশ্লেষণ',disclaimer:'⚠ শুধুমাত্র তথ্যের উদ্দেশ্যে। যোগ্য চিকিৎসকের পরামর্শ নিন।',nutritionSub:'আপনার চিকিৎসা অবস্থার উপর ভিত্তি করে ব্যক্তিগত খাদ্য নির্দেশনা।',navAdvisor:'উপদেষ্টা',navVoice:'ভয়েস',navAllergies:'অ্যালার্জি',navAnalyzer:'বিশ্লেষক',navConsult:'পরামর্শ',navDash:'ড্যাশবোর্ড',navNutrition:'পুষ্টি',downloadReport:'📄 রিপোর্ট ডাউনলোড'}},
  te:{flag:'🇮🇳',keys:{bioInterface:'జీవ ఇంటర్‌ఫేస్',neuralEngine:'⚕ నాడీ విశ్లేషణ ఇంజిన్',advisorSub:'తక్షణ AI-ఆధారిత విశ్లేషణ కోసం మీ వైద్య ప్రొఫైల్ నమోదు చేయండి.',bloodGroup:'రక్త సమూహం',bloodPressure:'రక్తపోటు',allergies:'తెలిసిన అలెర్జీలు',medications:'ప్రస్తుత మందులు',dosage:'మోతాదు',analyzeBtn:'⚡ ప్రతిచర్య విశ్లేషించు',disclaimer:'⚠ సమాచార ప్రయోజనాల కోసం మాత్రమే. అర్హత గల వైద్యుడిని సంప్రదించండి.',nutritionSub:'మీ వైద్య పరిస్థితి ఆధారంగా వ్యక్తిగత ఆహార మార్గదర్శకత్వం.',navAdvisor:'సలహాదారు',navVoice:'వాయిస్',navAllergies:'అలెర్జీలు',navAnalyzer:'విశ్లేషకుడు',navConsult:'సంప్రదింపు',navDash:'డాష్‌బోర్డ్',navNutrition:'పోషణ',downloadReport:'📄 నివేదిక డౌన్‌లోడ్'}},
  mr:{flag:'🇮🇳',keys:{bioInterface:'जैविक इंटरफेस',neuralEngine:'⚕ न्यूरल विश्लेषण इंजिन',advisorSub:'त्वरित AI-चालित विश्लेषणासाठी तुमची वैद्यकीय प्रोफाइल प्रविष्ट करा.',bloodGroup:'रक्त गट',bloodPressure:'रक्तदाब',allergies:'ज्ञात ऍलर्जी',medications:'सध्याची औषधे',dosage:'डोस',analyzeBtn:'⚡ प्रतिक्रिया विश्लेषण करा',disclaimer:'⚠ केवळ माहितीच्या उद्देशाने. पात्र वैद्यांशी सल्लामसलत करा.',nutritionSub:'तुमच्या वैद्यकीय स्थितीनुसार वैयक्तिक आहार मार्गदर्शन.',navAdvisor:'सल्लागार',navVoice:'आवाज',navAllergies:'ऍलर्जी',navAnalyzer:'विश्लेषक',navConsult:'सल्ला',navDash:'डॅशबोर्ड',navNutrition:'पोषण',downloadReport:'📄 अहवाल डाउनलोड'}},
  ta:{flag:'🇮🇳',keys:{bioInterface:'உயிரியல் இடைமுகம்',neuralEngine:'⚕ நரம்பியல் பகுப்பாய்வு இயந்திரம்',advisorSub:'உடனடி AI-சார்ந்த பகுப்பாய்வுக்கு உங்கள் மருத்துவ சுயவிவரத்தை உள்ளிடவும்.',bloodGroup:'இரத்த வகை',bloodPressure:'இரத்த அழுத்தம்',allergies:'அறியப்பட்ட ஒவ்வாமைகள்',medications:'தற்போதைய மருந்துகள்',dosage:'அளவு',analyzeBtn:'⚡ எதிர்வினை பகுப்பாய்வு',disclaimer:'⚠ தகவல் நோக்கங்களுக்காக மட்டுமே. தகுதிவாய்ந்த மருத்துவரை அணுகவும்.',nutritionSub:'உங்கள் மருத்துவ நிலையின் அடிப்படையில் தனிப்பட்ட உணவு வழிகாட்டுதல்.',navAdvisor:'ஆலோசகர்',navVoice:'குரல்',navAllergies:'ஒவ்வாமை',navAnalyzer:'பகுப்பாய்வி',navConsult:'ஆலோசனை',navDash:'டாஷ்போர்டு',navNutrition:'ஊட்டம்',downloadReport:'📄 அறிக்கை பதிவிறக்கம்'}},
  es:{flag:'🇪🇸',keys:{bioInterface:'Interfaz Biológica',neuralEngine:'⚕ Motor de Análisis Neural',advisorSub:'Ingrese su perfil médico para análisis instantáneo impulsado por IA.',bloodGroup:'Grupo Sanguíneo',bloodPressure:'Presión Arterial (Sistólica)',allergies:'Alergias Conocidas',medications:'Medicación Actual',dosage:'Dosis',analyzeBtn:'⚡ Analizar Reacción',disclaimer:'⚠ Solo para fines informativos. Consulte siempre a un médico.',nutritionSub:'Orientación dietética personalizada basada en su condición médica.',navAdvisor:'Asesor',navVoice:'Voz',navAllergies:'Alergias',navAnalyzer:'Analizador',navConsult:'Consulta',navDash:'Panel',navNutrition:'Nutrición',downloadReport:'📄 Descargar Informe'}},
  fr:{flag:'🇫🇷',keys:{bioInterface:'Interface Biologique',neuralEngine:'⚕ Moteur d\'Analyse Neural',advisorSub:'Entrez votre profil médical pour une analyse IA instantanée.',bloodGroup:'Groupe Sanguin',bloodPressure:'Pression Artérielle (Systolique)',allergies:'Allergies Connues',medications:'Médicaments Actuels',dosage:'Posologie',analyzeBtn:'⚡ Analyser la Réaction',disclaimer:'⚠ À titre informatif uniquement. Consultez toujours un médecin.',nutritionSub:'Conseils diététiques personnalisés basés sur votre condition médicale.',navAdvisor:'Conseiller',navVoice:'Voix',navAllergies:'Allergies',navAnalyzer:'Analyseur',navConsult:'Consultation',navDash:'Tableau de Bord',navNutrition:'Nutrition',downloadReport:'📄 Télécharger le Rapport'}},
  de:{flag:'🇩🇪',keys:{bioInterface:'Biologisches Interface',neuralEngine:'⚕ KI-Analyse-Engine',advisorSub:'Geben Sie Ihr Medizinprofil für sofortige KI-Analyse ein.',bloodGroup:'Blutgruppe',bloodPressure:'Blutdruck (Systolisch)',allergies:'Bekannte Allergien',medications:'Aktuelle Medikamente',dosage:'Dosierung',analyzeBtn:'⚡ Reaktion Analysieren',disclaimer:'⚠ Nur zu Informationszwecken. Konsultieren Sie immer einen Arzt.',nutritionSub:'Personalisierte Ernährungsberatung basierend auf Ihrem Gesundheitszustand.',navAdvisor:'Berater',navVoice:'Stimme',navAllergies:'Allergien',navAnalyzer:'Analysator',navConsult:'Beratung',navDash:'Dashboard',navNutrition:'Ernährung',downloadReport:'📄 Bericht Herunterladen'}},
};

function setLang(l){
  const t=LANGS[l];if(!t)return;
  // Update all data-i18n elements
  document.querySelectorAll('[data-i18n]').forEach(el=>{
    const k=el.getAttribute('data-i18n');
    if(t.keys[k])el.textContent=t.keys[k];
  });
  // Update nav buttons with data-nav-i18n
  const navMap={home:'navAdvisor',voice:'navVoice',allergy:'navAllergies',analyzer:'navAnalyzer',consult:'navConsult',dash:'navDash',food:'navNutrition'};
  document.querySelectorAll('.nl button[data-p]').forEach(btn=>{
    const p=btn.dataset.p;
    const k=navMap[p];
    if(k&&t.keys[k])btn.textContent=t.keys[k];
  });
  // Update download report button
  const dlBtn=document.querySelector('[onclick="dlReport()"]');
  if(dlBtn&&t.keys.downloadReport)dlBtn.textContent=t.keys.downloadReport;
  document.documentElement.lang=l;
  toast('Language: '+t.flag+' selected','info',2000);
}

/* ══ CORE ══ */
// Particles
(function(){
  const c=document.getElementById('pc'),ctx=c.getContext('2d');
  let W,H,ps=[];
  function rsz(){W=c.width=innerWidth;H=c.height=innerHeight}rsz();
  window.addEventListener('resize',rsz);
  class P{constructor(){this.rs()}
    rs(){this.x=Math.random()*W;this.y=Math.random()*H;this.vx=(Math.random()-.5)*.28;this.vy=(Math.random()-.5)*.28;this.r=Math.random()*1.4+.4;this.a=Math.random()*.45+.1;this.h=[185,170,200,160][Math.floor(Math.random()*4)]}
    u(){this.x+=this.vx;this.y+=this.vy;if(this.x<0||this.x>W||this.y<0||this.y>H)this.rs()}
    d(){ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fillStyle=`hsla(${this.h},90%,70%,${this.a})`;ctx.fill()}
  }
  for(let i=0;i<100;i++)ps.push(new P());
  function draw(){
    ctx.clearRect(0,0,W,H);
    for(let i=0;i<ps.length;i++){
      ps[i].u();ps[i].d();
      for(let j=i+1;j<ps.length;j++){
        const dx=ps[i].x-ps[j].x,dy=ps[i].y-ps[j].y,d=Math.sqrt(dx*dx+dy*dy);
        if(d<95){ctx.beginPath();ctx.strokeStyle=`rgba(0,200,220,${(1-d/95)*.13})`;ctx.lineWidth=.5;ctx.moveTo(ps[i].x,ps[i].y);ctx.lineTo(ps[j].x,ps[j].y);ctx.stroke()}
      }
    }
    requestAnimationFrame(draw);
  }
  draw();
})();

// Loader
setTimeout(()=>document.getElementById('ls').classList.add('gone'),1700);

// Nav
document.getElementById('ham').addEventListener('click',function(){
  document.getElementById('nl').classList.toggle('open');
});

// Theme
document.getElementById('tbtn').addEventListener('click',function(){
  document.body.classList.toggle('light');this.textContent=document.body.classList.contains('light')?'🌙':'☀️';
});

// Toast
function toast(msg,type='info',ms=3200){
  const c=document.getElementById('tc'),icons={success:'✓',warning:'⚠',error:'✖',info:'ℹ'};
  const t=document.createElement('div');t.className=`toast ${type}`;t.innerHTML=`<span>${icons[type]||'ℹ'}</span><span>${msg}</span>`;
  c.appendChild(t);setTimeout(()=>{t.style.transition='opacity .3s,transform .3s';t.style.opacity='0';t.style.transform='translateX(100%)';setTimeout(()=>t.remove(),300)},ms);
}

// Page Router
let curPage='home';
let chartsInited=false;
function goPage(p){
  document.querySelectorAll('.page').forEach(x=>x.classList.remove('active'));
  document.getElementById('page-'+p).classList.add('active');
  document.querySelectorAll('.nl button').forEach(b=>{b.classList.toggle('act',b.dataset.p===p)});
  document.getElementById('nl').classList.remove('open');
  window.scrollTo(0,0);
  curPage=p;
  if(p==='dash'&&!chartsInited){chartsInited=true;setTimeout(initCharts,100);}
  if(p==='allergy'||p==='analyzer')renderAllergy();
  // Telehealth system hooks
  if(p==='telehealth')initTelehealthPage();
  if(p==='emergency')initEmergencyPage();
  if(p==='appointments')renderAppointments();
  if(p==='billing')renderBilling();
  if(p==='admindash')setTimeout(initAdminDash,100);
}

// Animate stats
setTimeout(()=>{
  function count(el,target,suf){let cur=0;const s=target/50;const t=setInterval(()=>{cur=Math.min(cur+s,target);el.textContent=Math.floor(cur)+suf;if(cur>=target)clearInterval(t)},25)}
  count(document.getElementById('sv1'),98,'%');
  count(document.getElementById('sv2'),2400,'');
  count(document.getElementById('sv3'),6,'');
},1800);

/* ══ ADVISOR FORM ══ */
const RDATA={
  bpHigh:[{t:'Hypertensive Risk Alert',d:'Elevated BP with your medications may increase cardiovascular strain.',s:'high'},{t:'NSAID Interaction',d:'NSAIDs can further elevate blood pressure. Consider alternatives.',s:'mod'}],
  bpLow:[{t:'Hypotension Advisory',d:'Low blood pressure detected. Certain medications may cause dizziness.',s:'mod'}],
  bpNorm:[{t:'BP Within Range',d:'Blood pressure is within acceptable limits. Continue monitoring.',s:'low'}],
  wbcHigh:[{t:'Leukocytosis Detected',d:'Elevated WBC count may indicate infection, inflammation, or hematologic disorder. Seek evaluation.',s:'high'}],
  wbcLow:[{t:'Leukopenia Advisory',d:'Low WBC count increases infection susceptibility. Avoid crowded places; consult physician.',s:'high'}],
  pltLow:[{t:'Thrombocytopenia Alert',d:'Low platelet count increases bleeding risk. Avoid blood thinners and contact sports.',s:'high'}],
  pltHigh:[{t:'Thrombocytosis Note',d:'Elevated platelet count may increase clotting risk. Monitor and discuss with physician.',s:'mod'}],
  hgbLow:[{t:'Anemia Indicator',d:'Low hemoglobin suggests possible anemia. Consider iron, B12, and folate evaluation.',s:'mod'}],
  gen:[
    {t:'Drug-Food Interaction',d:'Avoid grapefruit and high-potassium foods within 2 hours of dosing.',s:'mod'},
    {t:'Allergen Exposure Risk',d:'Environmental factors may trigger cross-reactive responses with your allergies.',s:'mod'},
    {t:'Dosage Timing Advisory',d:'Optimal dosage window is 7–9 AM to minimize side effects.',s:'low'},
    {t:'Hydration Alert',d:'Current medication profile requires ≥2.5L/day to prevent nephrotoxicity.',s:'low'}
  ]
};

// Store last submitted form data for allergy sync
let lastFormData={};

document.getElementById('af').addEventListener('submit',async function(e){
  e.preventDefault();
  const btn=this.querySelector('.abtn');btn.classList.add('loading');
  const fd=new FormData(this),v=Object.fromEntries(fd);
  lastFormData=v;
  saveHist(v);
  // Sync allergies
  if(v.al){
    const allergyList=v.al.split(',').map(a=>a.trim()).filter(Boolean);
    syncReportAllergies(allergyList);
  }
  await delay(2100);
  btn.classList.remove('loading');
  const rxns=[];
  const bp=parseInt(v.bp);
  if(!isNaN(bp)){if(bp>140)rxns.push(...RDATA.bpHigh);else if(bp<90)rxns.push(...RDATA.bpLow);else rxns.push(...RDATA.bpNorm);}
  const wbc=parseFloat(v.wbc);
  if(!isNaN(wbc)){if(wbc>11)rxns.push(...RDATA.wbcHigh);else if(wbc<4.5)rxns.push(...RDATA.wbcLow);}
  const plt=parseFloat(v.plt);
  if(!isNaN(plt)){if(plt<150)rxns.push(...RDATA.pltLow);else if(plt>400)rxns.push(...RDATA.pltHigh);}
  const hgb=parseFloat(v.hgb);
  if(!isNaN(hgb)&&hgb<12)rxns.push(...RDATA.hgbLow);
  if(v.med||v.al)rxns.push(...RDATA.gen.sort(()=>.5-Math.random()).slice(0,3));
  if(!rxns.length)rxns.push({t:'Scan Complete',d:'No critical interactions detected. Continue regular check-ups.',s:'low'});
  renderReactions(rxns);
  toast('Analysis complete — '+rxns.length+' reactions identified','success');
});

function renderReactions(rxns){
  const g=document.getElementById('rg');g.innerHTML='';
  const lb={low:'Low Risk',mod:'Moderate',high:'High Risk'};
  rxns.forEach((r,i)=>{
    const d=document.createElement('div');d.className='gc rc fi2';d.style.animationDelay=i*.08+'s';
    d.innerHTML=`<div class="rh"><div class="rt">${r.t}</div><span class="badge b${r.s==='mod'?'m':r.s==='high'?'h':'l'}">${lb[r.s]}</span></div><p class="rd">${r.d}</p><div class="sb"><div class="sf ${r.s}" style="width:0"></div></div><div style="font-size:10.5px;color:var(--dim);margin-top:10px">⚡ AI Analysis · ${new Date().toLocaleTimeString()}</div>`;
    g.appendChild(d);
    setTimeout(()=>{const sf=d.querySelector('.sf');sf.style.width=r.s==='low'?'28%':r.s==='mod'?'62%':'94%'},80+i*80);
  });
}

/* ══ VOICE ══ */
let recog=null,isListening=false,symSet=new Set();
const SYMS=['headache','pain','fever','cough','fatigue','nausea','dizziness','shortness','rash','swelling','chest','palpitations','insomnia','anxiety','itching','burning','weakness','blurred','numbness','tingling'];
const SYMINFO={Headache:{r:'mod',n:'Could indicate tension or vascular issues. Monitor frequency.'},Fever:{r:'high',n:'Elevated temperature — potential infection. Seek care if persistent.'},Cough:{r:'mod',n:'May indicate respiratory infection or allergic reaction.'},Fatigue:{r:'low',n:'Can result from anemia, sleep issues, or medication side effects.'},Nausea:{r:'mod',n:'May be medication-induced or gastrointestinal distress.'},Dizziness:{r:'mod',n:'Possible low BP or inner ear issue. Avoid driving.'},Chest:{r:'high',n:'Chest symptoms require immediate medical evaluation.'},Rash:{r:'mod',n:'Skin reactions could indicate allergic response.'},Pain:{r:'mod',n:'Context and location important for diagnosis.'}};

(function(){
  const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
  const mbtn=document.getElementById('mbtn'),ms=document.getElementById('ms'),vtr=document.getElementById('vtr'),wv=document.getElementById('wv'),vsym=document.getElementById('vsym'),mw=document.getElementById('mw');
  if(!SR){ms.textContent='Not supported – use Chrome';mbtn.disabled=true;mbtn.style.opacity='.4';return;}
  recog=new SR();recog.continuous=true;recog.interimResults=true;
  recog.onstart=()=>{mbtn.classList.add('on');mw.classList.add('on');ms.textContent='LISTENING...';ms.className='ms on';wv.classList.add('on');vtr.innerHTML=''};
  recog.onend=()=>{if(isListening)try{recog.start()}catch(e){}};
  recog.onresult=(e)=>{
    let fin='',inter='';
    for(let i=e.resultIndex;i<e.results.length;i++){const t=e.results[i][0].transcript;e.results[i].isFinal?fin+=t:inter+=t;}
    const txt=fin||inter;vtr.innerHTML=`<span style="color:var(--txt)">${txt}</span>`;
    if(fin){SYMS.forEach(k=>{if(fin.toLowerCase().includes(k))symSet.add(k.charAt(0).toUpperCase()+k.slice(1))});
      vsym.innerHTML='';symSet.forEach(s=>{const t=document.createElement('span');t.className='symtag';t.textContent='🔬 '+s;vsym.appendChild(t)});}
  };
  recog.onerror=(e)=>{ms.textContent='Error: '+e.error;stopListen()};
  mbtn.addEventListener('click',()=>{isListening?stopListen():startListen()});
  function startListen(){isListening=true;try{recog.start()}catch(e){}}
  function stopListen(){isListening=false;recog.stop();mbtn.classList.remove('on');mw.classList.remove('on');ms.textContent='READY';ms.className='ms';wv.classList.remove('on');}
  document.getElementById('vabtn').addEventListener('click',async()=>{
    if(!symSet.size){toast('No symptoms detected yet','warning');return;}
    const btn=document.getElementById('vabtn');btn.textContent='ANALYZING...';btn.disabled=true;
    await delay(1800);
    const res=document.getElementById('vres'),resc=document.getElementById('vresc');
    res.style.display='block';resc.innerHTML='<div style="font-family:var(--fd);font-size:10px;letter-spacing:3px;text-transform:uppercase;color:var(--teal);margin-bottom:18px">AI Symptom Analysis</div>';
    symSet.forEach(s=>{
      const info=SYMINFO[s]||{r:'low',n:'Symptom noted. Consult physician for full assessment.'};
      const bc=info.r==='high'?'bh':info.r==='mod'?'bm':'bl',lbl={high:'High Priority',mod:'Monitor',low:'Noted'};
      const div=document.createElement('div');div.className='ia '+info.r;
      div.innerHTML=`<div class="aii">🔬</div><div class="aic"><div class="ait" style="display:flex;align-items:center;gap:9px">${s} <span class="badge ${bc}">${lbl[info.r]}</span></div><div class="aid">${info.n}</div></div>`;
      resc.appendChild(div);
    });
    btn.textContent='ANALYZE SYMPTOMS';btn.disabled=false;toast('Voice analysis complete','success');
  });
  document.getElementById('vcbtn').addEventListener('click',()=>{
    symSet.clear();vtr.innerHTML='<em style="color:var(--dim)">Speak to begin...</em>';
    document.getElementById('vsym').innerHTML='<span style="font-size:12.5px;color:var(--dim);font-style:italic">Symptoms will appear here...</span>';
    document.getElementById('vres').style.display='none';
  });
})();

/* ══ ALLERGY ══ */
let ADB=[
  {n:'Peanuts',cat:'food',s:'high',i:'MAO inhibitors, Beta-blockers',fromReport:false},
  {n:'Penicillin',cat:'medicine',s:'high',i:'Warfarin, Methotrexate',fromReport:false},
  {n:'Latex',cat:'environment',s:'mod',i:'Bananas, Avocado, Kiwi',fromReport:false},
  {n:'Shellfish (General)',cat:'food',s:'high',i:'Iodine contrast dye',fromReport:false},
  {n:'Shrimp',cat:'food',s:'high',i:'Iodine contrast dye, Glucosamine',fromReport:false},
  {n:'Prawns',cat:'food',s:'high',i:'Iodine contrast dye, Glucosamine',fromReport:false},
  {n:'Crab',cat:'food',s:'high',i:'Iodine contrast dye, Chitin supplements',fromReport:false},
  {n:'Lobster',cat:'food',s:'high',i:'Iodine contrast dye, Chitin supplements',fromReport:false},
  {n:'Clams',cat:'food',s:'mod',i:'Blood thinners (Omega-3 interaction)',fromReport:false},
  {n:'Oysters',cat:'food',s:'mod',i:'Zinc supplement interactions',fromReport:false},
  {n:'Mussels',cat:'food',s:'mod',i:'Blood pressure medications',fromReport:false},
  {n:'Scallops',cat:'food',s:'mod',i:'Anticoagulants',fromReport:false},
  {n:'Sulfa Drugs',cat:'medicine',s:'high',i:'Diuretics, Diabetes meds',fromReport:false},
  {n:'Dust Mites',cat:'environment',s:'low',i:'ACE inhibitors',fromReport:false},
  {n:'Tree Nuts',cat:'food',s:'high',i:'Antihistamines (may mask)',fromReport:false},
  {n:'Aspirin',cat:'medicine',s:'mod',i:'Blood thinners, NSAIDs',fromReport:false},
  {n:'Bee Venom',cat:'environment',s:'high',i:'Beta-blockers, ACE inhibitors',fromReport:false},
  {n:'Milk / Dairy',cat:'food',s:'low',i:'Tetracycline antibiotics',fromReport:false},
  {n:'Eggs',cat:'food',s:'mod',i:'Yellow fever vaccine',fromReport:false},
  {n:'Gluten',cat:'food',s:'mod',i:'Some vitamin supplements',fromReport:false},
];
const IALERTS=[
  {p:'Peanuts + MAO inhibitors',s:'high',n:'Severe hypertensive crisis possible. Strictly contraindicated.'},
  {p:'Penicillin + Warfarin',s:'high',n:'Significantly increases bleeding risk. Requires physician review.'},
  {p:'Latex + Kiwi/Banana',s:'mod',n:'Cross-reactive latex-fruit syndrome. Avoid these foods if latex-allergic.'},
  {p:'Aspirin + NSAIDs',s:'mod',n:'Additive GI bleeding risk. Use with extreme caution.'},
  {p:'Dairy + Tetracycline',s:'low',n:'Dairy reduces tetracycline absorption. Take 2 hours apart.'},
];

// Sync allergens from report data
function syncReportAllergies(allergens){
  // Remove previously report-synced entries
  ADB=ADB.filter(a=>!a.fromReport);
  const catGuess={penicillin:'medicine',amoxicillin:'medicine',aspirin:'medicine',ibuprofen:'medicine',sulfa:'medicine',warfarin:'medicine',peanuts:'food',peanut:'food',shellfish:'food',shrimp:'food',prawn:'food',crab:'food',lobster:'food',clam:'food',oyster:'food',mussel:'food',scallop:'food',seafood:'food',dairy:'food',milk:'food',eggs:'food',egg:'food',wheat:'food',gluten:'food',dust:'environment',latex:'environment',pollen:'environment',mold:'environment'};
  allergens.forEach(a=>{
    if(!a)return;
    const al=a.toLowerCase();
    const cat=Object.keys(catGuess).find(k=>al.includes(k))?catGuess[Object.keys(catGuess).find(k=>al.includes(k))]:'medicine';
    // Check if already exists
    const exists=ADB.some(x=>x.n.toLowerCase()===a.toLowerCase());
    if(!exists){
      ADB.push({n:a,cat,s:'mod',i:'Cross-reference your physician before use',fromReport:true});
    }
  });
  if(allergens.length)toast('Allergen database updated from report data','success');
}

let aFilt='all';
function setAFilter(btn,f){document.querySelectorAll('.fch').forEach(b=>b.classList.remove('act'));btn.classList.add('act');aFilt=f;renderAllergy();}
function filterAllergy(){renderAllergy();}
function renderAllergy(){
  const q=(document.getElementById('asrch').value||'').toLowerCase();
  const tb=document.getElementById('atb');tb.innerHTML='';
  const lb={high:'High',mod:'Moderate',low:'Low'};
  ADB.filter(a=>(aFilt==='all'||a.cat===aFilt)&&(!q||a.n.toLowerCase().includes(q)||a.cat.includes(q))).forEach((a,i)=>{
    const bc=a.s==='high'?'bh':a.s==='mod'?'bm':'bl';
    const tr=document.createElement('tr');tr.style.animationDelay=i*.04+'s';
    const reportBadge=a.fromReport?'<span class="badge bt" style="margin-left:6px;font-size:7.5px">Report</span>':'';
    tr.innerHTML=`<td><strong>${a.n}</strong>${reportBadge}</td><td><span class="badge bi">${a.cat.charAt(0).toUpperCase()+a.cat.slice(1)}</span></td><td><span class="badge ${bc}">${lb[a.s]}</span></td><td style="color:var(--txt2);font-size:12.5px">${a.i}</td><td><div class="sb" style="width:90px"><div class="sf ${a.s}" style="width:${a.s==='high'?92:a.s==='mod'?55:24}%"></div></div></td>`;
    tb.appendChild(tr);
  });
  if(!tb.children.length)tb.innerHTML='<tr><td colspan="5" style="text-align:center;color:var(--dim);padding:28px">No results found.</td></tr>';
  const ia=document.getElementById('ialerts');ia.innerHTML='';
  const icons={high:'🚨',mod:'⚠️',low:'ℹ️'};
  IALERTS.forEach(a=>{const d=document.createElement('div');d.className='ia '+a.s;d.innerHTML=`<div class="aii">${icons[a.s]}</div><div class="aic"><div class="ait">${a.p}</div><div class="aid">${a.n}</div></div>`;ia.appendChild(d);});
}

/* ══ MEDICINE SAFETY CHECK ══ */
const MED_CONTRAINDICATIONS={
  ibuprofen:['aspirin','blood thinners','warfarin','kidney disease','hypertension'],
  amoxicillin:['penicillin'],
  warfarin:['aspirin','nsaids','ibuprofen','naproxen'],
  metformin:['kidney disease','renal'],
  lisinopril:['kidney disease','hyperkalemia','angioedema'],
  atorvastatin:['liver disease','myopathy'],
  ciprofloxacin:['tendon'],
  codeine:['respiratory'],
  sulfonamide:['sulfa'],
  morphine:['respiratory'],
  iodine:['shellfish','shrimp','crab','lobster','prawn','seafood'],
  contrast:['shellfish','shrimp','crab','lobster','prawn','seafood','iodine'],
  glucosamine:['shellfish','shrimp','prawn','crab','lobster'],
  chitosan:['shellfish','shrimp','crab','lobster'],
  omega3:['shellfish','clam','mussel','oyster'],
};

function checkMedSafety(){
  const medName=document.getElementById('medchk-name').value.trim();
  const allergyStr=document.getElementById('medchk-allergy').value.trim();
  const conditions=document.getElementById('medchk-conditions').value.trim();
  const medsStr=(document.getElementById('medchk-meds')?document.getElementById('medchk-meds').value.trim():'');
  if(!medName){toast('Please enter a medicine name','warning');return;}

  const result=document.getElementById('medchk-result');
  const content=document.getElementById('medchk-content');
  result.classList.add('visible');

  const medLower=medName.toLowerCase();
  const allergyList=(allergyStr||'').toLowerCase().split(',').map(x=>x.trim());
  const conditionList=(conditions||'').toLowerCase().split(',').map(x=>x.trim());
  // Also check from last form data
  if(lastFormData.al){allergyList.push(...lastFormData.al.toLowerCase().split(',').map(x=>x.trim()));}

  const risks=[];
  // Check allergy cross-refs
  allergyList.forEach(al=>{
    if(!al)return;
    // Direct name match
    if(medLower.includes(al)||al.includes(medLower)){
      risks.push({level:'high',msg:`Direct allergy conflict: Patient is allergic to <strong>${al}</strong> which conflicts with <strong>${medName}</strong>.`});
    }
    // Cross-reactive check
    const contra=Object.keys(MED_CONTRAINDICATIONS).find(k=>medLower.includes(k));
    if(contra&&MED_CONTRAINDICATIONS[contra].some(c=>al.includes(c)||c.includes(al))){
      risks.push({level:'high',msg:`Cross-reactivity risk: Allergy to <strong>${al}</strong> may react with <strong>${medName}</strong>.`});
    }
    // Seafood-specific check for iodine contrast dyes
    const seafoodItems=['shrimp','prawn','crab','lobster','shellfish','clam','oyster','mussel','scallop','seafood'];
    if(seafoodItems.some(s=>al.includes(s))&&(medLower.includes('iodine')||medLower.includes('contrast')||medLower.includes('glucosamine')||medLower.includes('chitosan'))){
      risks.push({level:'high',msg:`Seafood allergy risk: <strong>${al}</strong> allergy increases risk of reaction to iodine-based or shellfish-derived compounds in <strong>${medName}</strong>.`});
    }
  });
  // Check conditions
  conditionList.forEach(cond=>{
    if(!cond)return;
    const contra=Object.keys(MED_CONTRAINDICATIONS).find(k=>medLower.includes(k));
    if(contra&&MED_CONTRAINDICATIONS[contra].some(c=>cond.includes(c)||c.includes(cond))){
      risks.push({level:'mod',msg:`Condition caution: <strong>${medName}</strong> may be contraindicated in patients with <strong>${cond}</strong>.`});
    }
  });

  const safe=risks.filter(r=>r.level==='high').length===0;
  const safeColor=safe?'var(--green)':'var(--red)';
  const safeIcon=safe?'✅':'🚫';
  const safeLabel=safe?'Generally Safe to Use':'Use with Caution / Contraindicated';

  let html=`<div style="display:flex;align-items:center;gap:12px;margin-bottom:18px;padding:14px;border-radius:10px;background:${safe?'rgba(0,255,136,.07)':'rgba(255,45,85,.07)'};border:1px solid ${safe?'var(--green)':'var(--red)'}">
    <span style="font-size:28px">${safeIcon}</span>
    <div><div style="font-family:var(--fd);font-size:11px;color:${safeColor};letter-spacing:1px">${safeLabel}</div>
    <div style="font-size:12px;color:var(--txt2);margin-top:3px">${medName} · Safety Assessment</div></div></div>`;

  if(risks.length){
    html+='<div style="display:flex;flex-direction:column;gap:8px;margin-bottom:14px">';
    risks.forEach(r=>{
      const c=r.level==='high'?'var(--red)':'var(--orange)';
      html+=`<div style="padding:10px 14px;border-radius:8px;border-left:3px solid ${c};background:rgba(0,20,40,.4);font-size:12.5px;color:var(--txt2);line-height:1.6">${r.msg}</div>`;
    });
    html+='</div>';
  }else{
    html+='<div style="font-size:12.5px;color:var(--txt2);line-height:1.7;padding:10px 14px;border-radius:8px;background:rgba(0,255,136,.04);border:1px solid rgba(0,255,136,.15)">No known conflicts detected based on provided allergy and condition data. Always confirm with your physician before starting new medication.</div>';
  }
  html+=`<div style="font-size:10.5px;color:var(--dim);margin-top:14px;border-top:1px solid var(--border);padding-top:12px">⚠ This check is AI-assisted and verified against a medical database. It does not replace professional medical advice.</div>`;

  content.innerHTML=html;
  toast('Medicine safety check complete','success');
}

/* ══ DASHBOARD ══ */
function initCharts(){
  const lc=document.getElementById('cline');
  if(lc)new Chart(lc,{type:'line',data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],datasets:[{label:'WBC (×10³/µL)',data:[6.2,7.1,5.8,9.4,7.3,8.1,6.9,7.2],borderColor:'#00f5ff',backgroundColor:'rgba(0,245,255,.06)',tension:.4,fill:true,pointBackgroundColor:'#00f5ff',pointRadius:4},{label:'Platelet (×10³/µL ÷10)',data:[15,18,14,10,9.8,11,13,9.8],borderColor:'#00d4aa',backgroundColor:'rgba(0,212,170,.04)',tension:.4,fill:true,pointBackgroundColor:'#00d4aa',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#7eb8d4',font:{family:'Exo 2',size:11}}}},scales:{x:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}},y:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}}}}});
  const dc=document.getElementById('cdough');
  if(dc)new Chart(dc,{type:'doughnut',data:{labels:['Low Risk','Moderate','High Risk'],datasets:[{data:[58,30,12],backgroundColor:['rgba(0,255,136,.7)','rgba(255,140,0,.7)','rgba(255,45,85,.7)'],borderColor:['#00ff88','#ff8c00','#ff2d55'],borderWidth:1}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{legend:{position:'bottom',labels:{color:'#7eb8d4',font:{family:'Exo 2',size:11},padding:14}}}}});
  const hgb=document.getElementById('chgb');
  if(hgb)new Chart(hgb,{type:'line',data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],datasets:[{label:'Hemoglobin (g/dL)',data:[11.2,12.1,11.5,13.0,12.8,13.4,13.1,13.4],borderColor:'#ff8c00',backgroundColor:'rgba(255,140,0,.06)',tension:.4,fill:true,pointBackgroundColor:'#ff8c00',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#7eb8d4',font:{family:'Exo 2',size:11}}}},scales:{x:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}},y:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}}}}});
  const rbc=document.getElementById('crbc');
  if(rbc)new Chart(rbc,{type:'line',data:{labels:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug'],datasets:[{label:'RBC (×10⁶/µL)',data:[4.0,4.3,4.1,4.6,4.5,4.7,4.6,4.7],borderColor:'#00ff88',backgroundColor:'rgba(0,255,136,.04)',tension:.4,fill:true,pointBackgroundColor:'#00ff88',pointRadius:4}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'#7eb8d4',font:{family:'Exo 2',size:11}}}},scales:{x:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}},y:{ticks:{color:'#3a6a8a'},grid:{color:'rgba(0,100,150,.1)'}}}}});
  renderHistList();
}
const HIST_KEY='vitreos-hist';
function saveHist(d){const h=getHist();h.unshift({...d,ts:new Date().toISOString()});localStorage.setItem(HIST_KEY,JSON.stringify(h.slice(0,50)));}
function getHist(){try{return JSON.parse(localStorage.getItem(HIST_KEY)||'[]')}catch{return[]}}
function clearHist(){localStorage.removeItem(HIST_KEY);renderHistList();toast('History cleared','info')}
const SAMP=[{bg:'A+',wbc:'7.2',plt:'280',hgb:'13.4',med:'Metformin 500mg',ts:new Date(Date.now()-86400000).toISOString()},{bg:'A+',wbc:'9.1',plt:'195',hgb:'12.8',med:'Metformin, Atorvastatin',ts:new Date(Date.now()-86400000*5).toISOString()},{bg:'A+',wbc:'5.8',plt:'98',hgb:'11.5',med:'Metformin 500mg',ts:new Date(Date.now()-86400000*10).toISOString()},{bg:'A+',wbc:'11.4',plt:'340',hgb:'13.0',med:'Metformin, Losartan',ts:new Date(Date.now()-86400000*15).toISOString()},{bg:'A+',wbc:'7.0',plt:'260',hgb:'12.1',med:'Metformin, Losartan',ts:new Date(Date.now()-86400000*20).toISOString()}];
function renderHistList(){
  const el=document.getElementById('hlist');if(!el)return;el.innerHTML='';
  const h=getHist().length>0?getHist():SAMP;
  const lb=[['bl','Clear'],['bm','Review'],['bh','Alert']];
  h.slice(0,7).forEach((item,i)=>{
    const dt=new Date(item.ts);const d=document.createElement('div');d.className='hi';
    const wbc=item.wbc?`WBC:${item.wbc}`:'';const plt=item.plt?`PLT:${item.plt}`:'';
    d.innerHTML=`<div class="hd">${dt.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div><div class="hin"><div class="ht">${item.bg||'General'} · ${wbc} ${plt}</div><div class="hs2">${item.med||item.medications||'General check'}</div></div><span class="badge ${lb[i%3][0]}">${lb[i%3][1]}</span>`;
    el.appendChild(d);
  });
  const tot=document.getElementById('dtot');if(tot)tot.textContent=getHist().length||12;
}
function dlReport(){
  toast('Compiling PDF report...','info',2000);
  setTimeout(()=>{
    try{
      const {jsPDF}=window.jspdf;
      const doc=new jsPDF({orientation:'portrait',unit:'mm',format:'a4'});
      const W=doc.internal.pageSize.getWidth();
      const H=doc.internal.pageSize.getHeight();
      const cyan=[0,200,220],teal=[0,180,160],red=[200,50,80],orange=[200,120,0],green=[0,180,100],dim=[80,120,140];

      // Header
      doc.setFillColor(1,10,18);
      doc.rect(0,0,W,28,'F');
      doc.setFontSize(18);doc.setFont('helvetica','bold');doc.setTextColor(...cyan);
      doc.text('VITREOS — AI Medical Report',14,13);
      doc.setFontSize(8);doc.setFont('helvetica','normal');doc.setTextColor(...dim);
      doc.text('Generated: '+new Date().toLocaleString(),14,21);
      doc.text('Confidential Medical Document',W-14,21,{align:'right'});

      let y=36;

      // Section: User Profile
      doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(...teal);
      doc.text('USER PROFILE',14,y);y+=6;
      doc.setDrawColor(...teal);doc.line(14,y,W-14,y);y+=5;
      const fd=lastFormData;
      const profileData=[
        ['Blood Group',fd.bg||'Not provided'],
        ['Blood Pressure (Systolic)',fd.bp?fd.bp+' mmHg':'Not provided'],
        ['Known Allergies',fd.al||'None recorded'],
        ['Current Medication',fd.med||'None recorded'],
        ['Dosage',fd.dos||'N/A'],
        ['WBC Count',fd.wbc?fd.wbc+' ×10³/µL':'N/A'],
        ['Hemoglobin',fd.hgb?fd.hgb+' g/dL':'N/A'],
        ['Platelet Count',fd.plt?fd.plt+' ×10³/µL':'N/A'],
        ['RBC Count',fd.rbc?fd.rbc+' ×10⁶/µL':'N/A'],
      ];
      doc.autoTable({startY:y,head:[['Parameter','Value']],body:profileData,theme:'grid',headStyles:{fillColor:[0,40,80],textColor:cyan,fontStyle:'bold',fontSize:9},bodyStyles:{textColor:[200,220,240],fillColor:[2,14,26],fontSize:9},alternateRowStyles:{fillColor:[0,20,40]},margin:{left:14,right:14}});
      y=doc.lastAutoTable.finalY+10;

      // Section: Allergy Analysis
      if(y>H-40){doc.addPage();y=20;}
      doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(...teal);
      doc.text('ALLERGY ANALYSIS',14,y);y+=6;
      doc.setDrawColor(...teal);doc.line(14,y,W-14,y);y+=5;
      const allergyRows=ADB.slice(0,12).map(a=>[a.n,a.cat.charAt(0).toUpperCase()+a.cat.slice(1),a.s.toUpperCase(),a.i,a.fromReport?'Report-Sync':'Base DB']);
      doc.autoTable({startY:y,head:[['Allergen','Category','Severity','Interactions','Source']],body:allergyRows,theme:'grid',headStyles:{fillColor:[0,40,80],textColor:cyan,fontStyle:'bold',fontSize:9},bodyStyles:{textColor:[200,220,240],fillColor:[2,14,26],fontSize:8},alternateRowStyles:{fillColor:[0,20,40]},margin:{left:14,right:14}});
      y=doc.lastAutoTable.finalY+10;

      // Section: Risk Summary
      if(y>H-40){doc.addPage();y=20;}
      doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(...teal);
      doc.text('ALLERGIC REACTION RISK SUMMARY',14,y);y+=6;
      doc.setDrawColor(...teal);doc.line(14,y,W-14,y);y+=5;
      const riskRows=[['Low Risk (Mild or no reaction)','58%','Normal monitoring. Minor precautions recommended.'],['Moderate Risk (Hives, swelling)','30%','Carry antihistamines. Notify care providers.'],['High Risk (Anaphylaxis risk)','12%','Carry EpiPen. Strict avoidance required.']];
      doc.autoTable({startY:y,head:[['Risk Level','Distribution','Guidance']],body:riskRows,theme:'grid',headStyles:{fillColor:[0,40,80],textColor:cyan,fontStyle:'bold',fontSize:9},bodyStyles:{textColor:[200,220,240],fillColor:[2,14,26],fontSize:9},alternateRowStyles:{fillColor:[0,20,40]},margin:{left:14,right:14}});
      y=doc.lastAutoTable.finalY+10;

      // Section: Symptom History (Sample)
      if(y>H-40){doc.addPage();y=20;}
      doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(...teal);
      doc.text('ANALYSIS HISTORY',14,y);y+=6;
      doc.setDrawColor(...teal);doc.line(14,y,W-14,y);y+=5;
      const hist=getHist().length>0?getHist():SAMP;
      const histRows=hist.slice(0,8).map(h=>[new Date(h.ts).toLocaleDateString(),h.bg||'—',h.wbc||'—',h.plt||'—',h.hgb||'—',h.med||'General check']);
      doc.autoTable({startY:y,head:[['Date','Blood Group','WBC','Platelet','Hgb','Medication']],body:histRows,theme:'grid',headStyles:{fillColor:[0,40,80],textColor:cyan,fontStyle:'bold',fontSize:9},bodyStyles:{textColor:[200,220,240],fillColor:[2,14,26],fontSize:8},alternateRowStyles:{fillColor:[0,20,40]},margin:{left:14,right:14}});
      y=doc.lastAutoTable.finalY+10;

      // Section: Critical Interaction Alerts
      if(y>H-40){doc.addPage();y=20;}
      doc.setFontSize(11);doc.setFont('helvetica','bold');doc.setTextColor(200,80,100);
      doc.text('CRITICAL INTERACTION ALERTS',14,y);y+=6;
      doc.setDrawColor(200,80,100);doc.line(14,y,W-14,y);y+=5;
      const alertRows=IALERTS.map(a=>[a.p,a.s.toUpperCase(),a.n]);
      doc.autoTable({startY:y,head:[['Interaction Pair','Severity','Advisory Note']],body:alertRows,theme:'grid',headStyles:{fillColor:[60,0,20],textColor:[255,150,170],fontStyle:'bold',fontSize:9},bodyStyles:{textColor:[200,220,240],fillColor:[2,14,26],fontSize:9},alternateRowStyles:{fillColor:[0,20,40]},margin:{left:14,right:14}});
      y=doc.lastAutoTable.finalY+10;

      // Footer on all pages
      const totalPages=doc.getNumberOfPages();
      for(let i=1;i<=totalPages;i++){
        doc.setPage(i);
        doc.setFillColor(1,10,18);doc.rect(0,H-12,W,12,'F');
        doc.setFontSize(7);doc.setFont('helvetica','normal');doc.setTextColor(...dim);
        doc.text('VITREOS AI Medical Advisor — Confidential. For informational purposes only. Not a substitute for professional medical advice.',14,H-4);
        doc.text('Page '+i+' of '+totalPages,W-14,H-4,{align:'right'});
      }

      doc.save('VITREOS_Medical_Report_'+new Date().toISOString().slice(0,10)+'.pdf');
      toast('PDF report downloaded!','success');
    }catch(err){
      console.error('PDF error:',err);
      toast('PDF generation failed. Trying fallback...','warning');
      window.print();
    }
  },800);
}

/* ══ FOOD ══ */
const FD={
  diabetes:{eat:[{i:'🥦',n:'Broccoli',b:'+Fiber, -Glucose'},{i:'🐟',n:'Salmon',b:'+Omega-3'},{i:'🥑',n:'Avocado',b:'+Healthy Fats'},{i:'🫐',n:'Blueberries',b:'+Antioxidants'},{i:'🌰',n:'Almonds',b:'+Mg, -Insulin'},{i:'🥬',n:'Spinach',b:'+Magnesium'}],avoid:[{i:'🍞',n:'White Bread',b:'High GI'},{i:'🥤',n:'Sugary Drinks',b:'Spikes glucose'},{i:'🍫',n:'Candy',b:'Rapid sugar rise'},{i:'🍟',n:'Fried Foods',b:'Insulin resistance'}]},
  hypertension:{eat:[{i:'🍌',n:'Bananas',b:'+Potassium'},{i:'🥦',n:'Beets',b:'-Blood Pressure'},{i:'🐟',n:'Fatty Fish',b:'+Omega-3'},{i:'🫐',n:'Berries',b:'+Flavonoids'},{i:'🌱',n:'Flaxseed',b:'-Systolic BP'},{i:'🧄',n:'Garlic',b:'Vasodilator'}],avoid:[{i:'🧂',n:'Excess Salt',b:'Raises BP'},{i:'🥓',n:'Processed Meats',b:'High Sodium'},{i:'🍸',n:'Alcohol',b:'Vasoconstrictor'},{i:'☕',n:'Excess Caffeine',b:'Raises BP short-term'}]},
  anemia:{eat:[{i:'🥩',n:'Red Meat',b:'+Heme Iron'},{i:'🥬',n:'Spinach',b:'+Non-heme Iron'},{i:'🫘',n:'Lentils',b:'+Iron, +Folate'},{i:'🌰',n:'Pumpkin Seeds',b:'+Iron, +Zinc'},{i:'🍊',n:'Citrus Fruits',b:'+Vit C absorption'},{i:'🥦',n:'Broccoli',b:'+Iron + Vit C'}],avoid:[{i:'☕',n:'Coffee / Tea',b:'Blocks Iron absorption'},{i:'🥛',n:'Excess Dairy',b:'Competes with Iron'},{i:'🍷',n:'Wine',b:'Tannins block Iron'},{i:'🌾',n:'Excess Whole Grains',b:'Phytates inhibit Fe'}]},
  allergy:{eat:[{i:'🍎',n:'Quercetin-rich Foods',b:'Natural antihistamine'},{i:'🫚',n:'Olive Oil',b:'+Anti-inflammatory'},{i:'🧅',n:'Onions',b:'+Quercetin'},{i:'🌿',n:'Stinging Nettle',b:'Natural allergy relief'},{i:'🍋',n:'Vitamin C Foods',b:'Reduces histamine'},{i:'🫛',n:'Pineapple (Bromelain)',b:'Anti-inflammatory'}],avoid:[{i:'🍷',n:'Alcohol',b:'Increases histamine'},{i:'🧀',n:'Fermented Foods',b:'High histamine'},{i:'🍅',n:'Tomatoes',b:'Histamine liberator'},{i:'🍓',n:'Strawberries',b:'Histamine trigger'}]},
  thyroid:{eat:[{i:'🥜',n:'Brazil Nuts',b:'+Selenium'},{i:'🐟',n:'Tuna',b:'+Iodine'},{i:'🥚',n:'Eggs',b:'+Selenium, +Iodine'},{i:'🫐',n:'Blueberries',b:'+Antioxidants'},{i:'🫘',n:'Beans',b:'+Fiber, +Zinc'},{i:'🍎',n:'Apples',b:'+Quercetin'}],avoid:[{i:'🥦',n:'Raw Cruciferous Veg',b:'Goitrogens'},{i:'🌿',n:'Raw Kale',b:'Inhibits thyroid'},{i:'🍵',n:'Excess Green Tea',b:'Interferes with meds'},{i:'🧂',n:'Excess Iodine',b:'Can worsen thyroid'}]},
  pcos:{eat:[{i:'🥬',n:'Leafy Greens',b:'+Anti-inflammatory'},{i:'🫐',n:'Berries',b:'+Antioxidants'},{i:'🐟',n:'Fatty Fish',b:'+Omega-3'},{i:'🌰',n:'Walnuts',b:'+Healthy Fats'},{i:'🫘',n:'Lentils',b:'+Low GI Protein'},{i:'🥑',n:'Avocado',b:'+Healthy Fats'}],avoid:[{i:'🍞',n:'Refined Carbs',b:'Blood sugar spikes'},{i:'🥛',n:'Full-fat Dairy',b:'May worsen hormones'},{i:'🥩',n:'Processed Meats',b:'+Inflammation'},{i:'🧁',n:'Sugary Foods',b:'Insulin resistance'}]},
};

// AI-powered free text food recommendations
const AI_FOOD_TEMPLATES={
  default:(cond)=>({
    eat:[
      {i:'🥗',n:'Anti-inflammatory Foods',b:`Beneficial for ${cond}`},
      {i:'🫐',n:'Antioxidant-rich Berries',b:'Reduces oxidative stress'},
      {i:'🐟',n:'Omega-3 Rich Fish',b:'Supports recovery'},
      {i:'🥬',n:'Dark Leafy Greens',b:'+Vitamins & Minerals'},
      {i:'🌰',n:'Nuts & Seeds',b:'Healthy fats & fiber'},
      {i:'🍵',n:'Herbal Teas',b:'Anti-inflammatory'},
    ],
    avoid:[
      {i:'🍟',n:'Fried & Processed Foods',b:'Worsens inflammation'},
      {i:'🍭',n:'Added Sugar',b:'Metabolic stress'},
      {i:'🥃',n:'Alcohol',b:`Contraindicated with ${cond}`},
      {i:'🧂',n:'Excess Sodium',b:'Increases risk factors'},
    ]
  })
};

function renderFoodData(data,condLabel){
  function r(el,items,isAvoid){
    el.innerHTML='';
    items.forEach(item=>{const d=document.createElement('div');d.className='fit'+(isAvoid?' avo':'');d.innerHTML=`<span class="fito">${item.i}</span><span class="fitn">${item.n}</span><span class="fitb">${item.b}</span>`;el.appendChild(d);});
  }
  r(document.getElementById('feat'),data.eat,false);
  r(document.getElementById('favd'),data.avoid,true);
  if(condLabel)toast('Recommendations loaded for: '+condLabel,'success');
}

function quickFood(btn,c){
  document.querySelectorAll('.cp').forEach(b=>b.classList.remove('act'));
  btn.classList.add('act');
  document.getElementById('condInput').value='';
  if(FD[c])renderFoodData(FD[c]);
}

async function fetchFoodRec(){
  const cond=document.getElementById('condInput').value.trim();
  if(!cond){toast('Please enter a condition','warning');return;}
  document.querySelectorAll('.cp').forEach(b=>b.classList.remove('act'));
  // Check if we have static data for this condition
  const condLower=cond.toLowerCase();
  const staticKey=Object.keys(FD).find(k=>condLower.includes(k));
  if(staticKey){renderFoodData(FD[staticKey],cond);return;}
  // Generate AI-style recommendations
  document.getElementById('foodLoading').classList.add('show');
  await delay(1400);
  document.getElementById('foodLoading').classList.remove('show');
  const data=AI_FOOD_TEMPLATES.default(cond);
  renderFoodData(data,cond);
}

/* ══ CONSULT CORNER ══ */
function appendSymptom(s){
  const inp=document.getElementById('symptom-input');
  inp.value=(inp.value?inp.value+', ':'')+s;
}

const CONDITION_MAP={
  headache:['Tension Headache','Migraine','Cluster Headache','Hypertension'],
  fever:['Viral Infection','Bacterial Infection','COVID-19','Influenza'],
  cough:['Common Cold','Bronchitis','Asthma','Pneumonia'],
  fatigue:['Anemia','Hypothyroidism','Vitamin D Deficiency','Chronic Fatigue Syndrome'],
  nausea:['Gastroenteritis','Food Poisoning','GERD','Pregnancy'],
  chest:['Angina','Costochondritis','GERD','Anxiety Disorder'],
  dizziness:['Vertigo','Low Blood Pressure','Inner Ear Infection','Anemia'],
  rash:['Eczema','Allergic Reaction','Psoriasis','Contact Dermatitis'],
};
const REMEDIES_MAP={
  headache:['💧 Hydrate well (8+ glasses of water)','🛌 Rest in a quiet, dark room','🧊 Apply cold compress to forehead','🌿 Peppermint oil on temples'],
  fever:['💧 Increase fluid intake','🌡️ Rest and avoid exertion','🫧 Lukewarm sponge bath','🍵 Ginger-honey tea'],
  cough:['🍯 Honey with warm water','💨 Steam inhalation with eucalyptus','🧂 Salt water gargle','🛌 Elevate head while sleeping'],
  fatigue:['😴 Prioritize 7–9 hours of sleep','🥗 Iron-rich and balanced diet','🚶 Light exercise (20-min walk)','☀️ Morning sunlight exposure'],
  nausea:['🫚 Ginger tea or candies','🍋 Lemon water sips','🌬️ Fresh air and slow breathing','🍚 Bland foods (rice, toast)'],
  default:['💧 Stay well hydrated','🛌 Get adequate rest','🍎 Eat a balanced diet','📞 Monitor and consult doctor if symptoms worsen'],
};

async function analyzeSymptoms(){
  const inp=document.getElementById('symptom-input').value.trim();
  if(!inp){toast('Please describe your symptoms','warning');return;}
  const spin=document.getElementById('consult-spin');spin.style.display='inline-block';
  await delay(1800);
  spin.style.display='none';

  // Parse symptoms
  const inpLower=inp.toLowerCase();
  const matchedKey=Object.keys(CONDITION_MAP).find(k=>inpLower.includes(k));
  const conditions=matchedKey?CONDITION_MAP[matchedKey]:['General Illness','Systemic Condition','Stress-Related Disorder'];
  const remedies=REMEDIES_MAP[matchedKey]||REMEDIES_MAP.default;

  // Determine severity from keywords
  let severity='low';
  if(/chest pain|difficulty breathing|unconscious|severe|emergency/i.test(inp))severity='high';
  else if(/fever|vomiting|persistent|worsening|multiple/i.test(inp))severity='mod';

  const sevColor={low:'var(--green)',mod:'var(--orange)',high:'var(--red)'};
  const sevLabel={low:'Non-Urgent',mod:'Moderate — Monitor',high:'High Priority — Seek Care'};

  const result=document.getElementById('consult-result');
  const output=document.getElementById('consult-output');
  result.classList.add('visible');

  output.innerHTML=`
    <div class="stag2" style="margin-bottom:12px">🧠 AI Symptom Analysis</div>
    <div style="margin-bottom:18px">
      <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin-bottom:8px">Severity Assessment</div>
      <div style="padding:12px 16px;border-radius:8px;border:1px solid ${sevColor[severity]};background:rgba(0,20,40,.4);font-family:var(--fd);font-size:11px;color:${sevColor[severity]};letter-spacing:1px">
        ${severity==='high'?'🚨':severity==='mod'?'⚠️':'✅'} ${sevLabel[severity]}
      </div>
    </div>
    <div style="margin-bottom:18px">
      <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin-bottom:8px">Possible Conditions</div>
      <div style="display:flex;flex-wrap:wrap;gap:7px">
        ${conditions.map(c=>`<span class="badge bi" style="padding:5px 12px;font-size:9px">${c}</span>`).join('')}
      </div>
    </div>
    <div style="margin-bottom:18px">
      <div style="font-family:var(--fd);font-size:9.5px;letter-spacing:2px;color:var(--dim);text-transform:uppercase;margin-bottom:8px">Home Remedies & Suggestions</div>
      <div class="remedy-list">${remedies.map(r=>`<div class="remedy-item">${r}</div>`).join('')}</div>
    </div>
    ${severity==='high'?`<div style="padding:14px;border-radius:10px;background:rgba(255,45,85,.08);border:1px solid var(--red);font-size:12.5px;color:var(--txt2);line-height:1.7;margin-bottom:14px"><strong style="color:var(--red)">⚠️ Urgent:</strong> Your symptoms suggest a potentially serious condition. Please consult a doctor immediately or use the Telehealth Connect options above.</div>`:''}
    <div style="font-size:10.5px;color:var(--dim);border-top:1px solid var(--border);padding-top:12px;margin-top:6px">⚡ AI Analysis verified against medical database · ${new Date().toLocaleTimeString()}</div>
  `;
  toast('Symptom analysis complete','success');
}

function appointDoctor(type){
  const label=type==='video'?'Video Call':'Audio Call';
  toast(`Initiating ${label} appointment booking...`,'info',3000);
  setTimeout(()=>toast('Connecting to next available doctor. Avg wait: ~2 minutes.','success',4000),1200);
}

/* ══ UTILS ══ */
function delay(ms){return new Promise(r=>setTimeout(r,ms));}

/* ══════════════════════════════════════
   TELEHEALTH SYSTEM
══════════════════════════════════════ */

// ── Region Data ──
const REGIONS = {
  India: {
    states: {
      'West Bengal': { cities: { 'Kolkata': ['700001','700002','700003','700019'], 'Howrah': ['711101','711102'], 'Siliguri': ['734001'] } },
      'Maharashtra': { cities: { 'Mumbai': ['400001','400002','400051'], 'Pune': ['411001','411002'], 'Nagpur': ['440001'] } },
      'Karnataka': { cities: { 'Bengaluru': ['560001','560002','560011'], 'Mysuru': ['570001'] } },
      'Tamil Nadu': { cities: { 'Chennai': ['600001','600002','600017'], 'Coimbatore': ['641001'] } },
      'Delhi': { cities: { 'New Delhi': ['110001','110002','110003'], 'North Delhi': ['110007'] } }
    }
  },
  USA: { states: { 'California': { cities: { 'Los Angeles':['90001'] } }, 'New York': { cities: { 'New York City':['10001'] } } } },
  UK: { states: { 'England': { cities: { 'London':['EC1A'] } } } }
};

// ── Doctors Database ──
const DOCTORS_DB = [
  {id:'D001',name:'Dr. Priya Sharma',spec:'General Physician',rating:4.9,exp:'12 yrs',lang:['Hindi','Bengali'],fee:250,visits:500,avatar:'👩‍⚕️',verified:true,online:true,region:'Kolkata'},
  {id:'D002',name:'Dr. Rahul Mehta',spec:'Cardiologist',rating:4.8,exp:'15 yrs',lang:['Hindi','English'],fee:250,visits:500,avatar:'👨‍⚕️',verified:true,online:true,region:'Kolkata'},
  {id:'D003',name:'Dr. Sunita Rao',spec:'Pediatrician',rating:4.7,exp:'9 yrs',lang:['Telugu','English'],fee:250,visits:500,avatar:'👩‍⚕️',verified:true,online:false,region:'Kolkata'},
  {id:'D004',name:'Dr. Arjun Singh',spec:'Neurologist',rating:4.9,exp:'18 yrs',lang:['Hindi','Punjabi'],fee:250,visits:500,avatar:'👨‍⚕️',verified:true,online:true,region:'Mumbai'},
  {id:'D005',name:'Dr. Kavitha Nair',spec:'Dermatologist',rating:4.6,exp:'7 yrs',lang:['Malayalam','English'],fee:250,visits:500,avatar:'👩‍⚕️',verified:true,online:true,region:'Chennai'},
  {id:'D006',name:'Dr. Aditya Kumar',spec:'Orthopedic',rating:4.8,exp:'13 yrs',lang:['Hindi','English'],fee:250,visits:500,avatar:'👨‍⚕️',verified:true,online:true,region:'Kolkata'},
];

// ── Hospitals Database ──
const HOSPITALS_DB = [
  {id:'H001',name:'Kolkata Medical College',type:'Government',dist:'0.8 km',beds:42,totalBeds:200,emoji:'🏥',region:'Kolkata'},
  {id:'H002',name:'Apollo Gleneagles',type:'Multi-Speciality',dist:'1.2 km',beds:8,totalBeds:300,emoji:'🏨',region:'Kolkata'},
  {id:'H003',name:'AMRI Hospitals',type:'Private',dist:'2.1 km',beds:18,totalBeds:150,emoji:'🏩',region:'Kolkata'},
  {id:'H004',name:'Fortis Hospital',type:'Multi-Speciality',dist:'3.5 km',beds:0,totalBeds:200,emoji:'🏥',region:'Kolkata'},
];

let selectedRegion = {country:'India', state:'West Bengal', city:'Kolkata', pin:'700001'};
let selectedDoctor = null;
let selectedTriage = null;
let activeCallTimer = null;
let emergencyTriggered = false;

// ══ TELEHEALTH PAGE ══
function initTelehealthPage(){
  renderRegionSelects();
  renderDoctors('Kolkata');
}

function renderRegionSelects(){
  const wrap = document.getElementById('region-form');
  if(!wrap)return;
  const countries = Object.keys(REGIONS);
  const states = Object.keys(REGIONS[selectedRegion.country]?.states||{});
  const cities = Object.keys(REGIONS[selectedRegion.country]?.states[selectedRegion.state]?.cities||{});
  const pins = REGIONS[selectedRegion.country]?.states[selectedRegion.state]?.cities[selectedRegion.city]||[];
  wrap.innerHTML=`
    <div class="region-grid">
      <div class="region-step">
        <div class="rs-num">01</div>
        <div class="rs-label">Country</div>
        <select class="fs" onchange="updateRegion('country',this.value)" style="width:100%">
          ${countries.map(c=>`<option ${c===selectedRegion.country?'selected':''}>${c}</option>`).join('')}
        </select>
      </div>
      <div class="region-step">
        <div class="rs-num">02</div>
        <div class="rs-label">State / Province</div>
        <select class="fs" onchange="updateRegion('state',this.value)" style="width:100%">
          ${states.map(s=>`<option ${s===selectedRegion.state?'selected':''}>${s}</option>`).join('')}
        </select>
      </div>
      <div class="region-step">
        <div class="rs-num">03</div>
        <div class="rs-label">City</div>
        <select class="fs" onchange="updateRegion('city',this.value)" style="width:100%">
          ${cities.map(c=>`<option ${c===selectedRegion.city?'selected':''}>${c}</option>`).join('')}
        </select>
      </div>
      <div class="region-step">
        <div class="rs-num">04</div>
        <div class="rs-label">Pincode</div>
        <select class="fs" onchange="updateRegion('pin',this.value)" style="width:100%">
          ${pins.map(p=>`<option ${p===selectedRegion.pin?'selected':''}>${p}</option>`).join('')}
        </select>
      </div>
    </div>
    <div style="text-align:center;margin-bottom:10px">
      <button class="btn bs" onclick="autoGPS()" style="font-size:9px;padding:9px 18px">📍 Auto-Detect GPS Location</button>
    </div>
  `;
}

function updateRegion(key, val){
  selectedRegion[key] = val;
  if(key==='country'){selectedRegion.state=Object.keys(REGIONS[val]?.states||{})[0]||'';selectedRegion.city='';}
  if(key==='state'){selectedRegion.city=Object.keys(REGIONS[selectedRegion.country]?.states[val]?.cities||{})[0]||'';}
  renderRegionSelects();
  renderDoctors(selectedRegion.city);
}

function autoGPS(){
  toast('Detecting location via GPS...','info',2000);
  setTimeout(()=>{
    selectedRegion={country:'India',state:'West Bengal',city:'Kolkata',pin:'700001'};
    renderRegionSelects();
    renderDoctors('Kolkata');
    toast('Location detected: Kolkata, West Bengal','success');
  },1500);
}

function renderDoctors(city){
  const wrap = document.getElementById('doctors-grid');
  if(!wrap)return;
  const docs = DOCTORS_DB.filter(d=>d.region===city||!city);
  if(!docs.length){wrap.innerHTML=`<div class="re"><div class="rei">🔍</div><p>No doctors found in this region</p></div>`;return;}
  wrap.innerHTML = docs.map(d=>`
    <div class="doctor-full-card">
      <div class="dfc-top">
        <div class="dfc-avatar">${d.avatar}</div>
        <div>
          <div class="dfc-name">${d.name}</div>
          <div class="dfc-spec">${d.spec}</div>
          <div class="dfc-rating">⭐ ${d.rating} · ${d.exp} exp</div>
        </div>
      </div>
      <div class="dfc-badges">
        ${d.verified?'<span class="badge bt">✓ Verified</span>':''}
        <span class="badge ${d.online?'bl':'bm'}">${d.online?'● Online':'○ Offline'}</span>
        ${d.lang.map(l=>`<span class="badge bi" style="font-size:8px">${l}</span>`).join('')}
      </div>
      <div style="font-family:var(--fd);font-size:10px;color:var(--txt2);margin-bottom:12px">
        💰 Video: ₹250 &nbsp;|&nbsp; Visit: ₹500–600
      </div>
      <div class="dfc-actions">
        <button class="dfc-btn video" onclick="bookVideoCall('${d.id}')">📹 Video Call</button>
        <button class="dfc-btn visit" onclick="bookVisit('${d.id}')">🏥 Book Visit</button>
      </div>
    </div>
  `).join('');
}

function selectTriage(level){
  selectedTriage=level;
  document.querySelectorAll('.triage-card').forEach(c=>c.style.opacity=c.dataset.level===level?'1':'.5');
  const labels={easy:'🟢 Easy — Video Consult',moderate:'🟡 Moderate — Physical Visit',critical:'🔴 Critical — Emergency'};
  toast(`Triage Level: ${labels[level]}`,'info',3000);
  if(level==='critical'){triggerEmergencyAlert();}
}

function bookVideoCall(docId){
  selectedDoctor = DOCTORS_DB.find(d=>d.id===docId);
  document.getElementById('vc-doctor-name').textContent=selectedDoctor?.name||'Doctor';
  document.getElementById('vc-doctor-spec').textContent=selectedDoctor?.spec||'';
  document.getElementById('payment-modal').classList.add('open');
}

function bookVisit(docId){
  selectedDoctor = DOCTORS_DB.find(d=>d.id===docId);
  goPage('appointments');
  setTimeout(()=>{
    document.getElementById('new-appt-section').scrollIntoView({behavior:'smooth'});
    if(selectedDoctor){
      document.getElementById('appt-doctor-sel').value=selectedDoctor.name;
      toast(`Booking visit with ${selectedDoctor.name}`,'success');
    }
  },300);
}

// ══ PAYMENT MODAL ══
function confirmPayment(){
  document.getElementById('payment-modal').classList.remove('open');
  document.getElementById('video-call-modal').classList.add('open');
  startVideoCallTimer();
  toast('Payment successful! Connecting to doctor...','success');
}

function startVideoCallTimer(){
  let secs=0;
  const el=document.getElementById('vc-timer');
  clearInterval(activeCallTimer);
  setTimeout(()=>{
    document.getElementById('vc-status').classList.add('live');
    document.getElementById('vc-connecting').style.display='none';
    document.getElementById('vc-live-ui').style.display='flex';
    toast('Doctor connected!','success');
  },2500);
  activeCallTimer=setInterval(()=>{
    secs++;
    const m=String(Math.floor(secs/60)).padStart(2,'0');
    const s=String(secs%60).padStart(2,'0');
    if(el)el.textContent=`${m}:${s}`;
  },1000);
}

function endVideoCall(){
  clearInterval(activeCallTimer);
  document.getElementById('video-call-modal').classList.remove('open');
  document.getElementById('post-call-modal').classList.add('open');
  toast('Call ended. Duration: 12:34','info');
}

function submitRating(stars){
  document.querySelectorAll('.star-btn').forEach((b,i)=>b.style.color=i<stars?'var(--orange)':'var(--dim)');
  setTimeout(()=>{
    document.getElementById('post-call-modal').classList.remove('open');
    toast('Thank you for your feedback!','success');
    addTransaction({title:`Video Call — ${selectedDoctor?.name||'Doctor'}`,type:'debit',amount:'₹250',icon:'📹',date:new Date().toLocaleDateString()});
  },800);
}

// ══ EMERGENCY PAGE ══
const CRITICAL_SYMPTOMS=[
  {icon:'💔',name:'Severe Chest Pain',desc:'Crushing pressure, radiating to arm/jaw',sev:'CRITICAL'},
  {icon:'😮‍💨',name:'Breathing Difficulty',desc:'Unable to breathe, gasping for air',sev:'CRITICAL'},
  {icon:'🧠',name:'Stroke Symptoms',desc:'Sudden numbness, slurred speech, vision loss',sev:'CRITICAL'},
  {icon:'😵',name:'Loss of Consciousness',desc:'Unresponsive, fainting, seizure',sev:'CRITICAL'},
  {icon:'🩸',name:'Severe Hemorrhage',desc:'Uncontrolled bleeding, internal bleeding',sev:'CRITICAL'},
  {icon:'🤕',name:'Head Injury',desc:'Severe trauma, concussion symptoms',sev:'HIGH'},
  {icon:'🌡️',name:'High Fever (>104°F)',desc:'Persistent fever with severe symptoms',sev:'HIGH'},
  {icon:'💊',name:'Drug Overdose',desc:'Medication overdose, poisoning',sev:'CRITICAL'},
];

function initEmergencyPage(){
  const wrap=document.getElementById('critical-symptoms-list');
  if(!wrap)return;
  wrap.innerHTML=CRITICAL_SYMPTOMS.map((s,i)=>`
    <div class="cs-item" onclick="toggleCriticalSymptom(this,${i})" data-idx="${i}">
      <span class="cs-icon">${s.icon}</span>
      <div class="cs-text">
        <div class="cs-name">${s.name}</div>
        <div class="cs-desc">${s.desc}</div>
      </div>
      <span class="cs-severity">${s.sev}</span>
    </div>
  `).join('');
  renderHospitals();
}

let selectedCriticalSymptoms=[];
function toggleCriticalSymptom(el,idx){
  el.classList.toggle('selected');
  const sym=CRITICAL_SYMPTOMS[idx];
  if(el.classList.contains('selected')){
    selectedCriticalSymptoms.push(sym);
    if(sym.sev==='CRITICAL')triggerEmergencyAlert(sym.name);
  } else {
    selectedCriticalSymptoms=selectedCriticalSymptoms.filter(s=>s.name!==sym.name);
  }
}

function renderHospitals(){
  const wrap=document.getElementById('nearby-hospitals');
  if(!wrap)return;
  wrap.innerHTML=HOSPITALS_DB.filter(h=>h.region===selectedRegion.city||true).slice(0,4).map(h=>{
    const pct=h.beds/h.totalBeds;
    const cls=pct===0?'full':pct<0.1?'low':'';
    const bedLabel=h.beds===0?'FULL':''+h.beds+' beds free';
    return `<div class="hosp-item">
      <span class="hosp-icon">${h.emoji}</span>
      <div class="hosp-info">
        <div class="hosp-name">${h.name}</div>
        <div class="hosp-dist">📍 ${h.dist} · ${h.type}</div>
      </div>
      <span class="hosp-beds ${cls}">${bedLabel}</span>
    </div>`;
  }).join('');
}

function triggerEmergencyAlert(symptom='Critical Condition'){
  const alert=document.getElementById('emergency-alert');
  if(!alert)return;
  document.getElementById('alert-symptom').textContent=symptom;
  alert.classList.add('show');
}

function confirmEmergency(){
  document.getElementById('emergency-alert').classList.remove('show');
  emergencyTriggered=true;
  toast('🚨 EMERGENCY TRIGGERED — Ambulance dispatched!','error',5000);
  setTimeout(()=>toast('🏥 Apollo Gleneagles notified — Bed reserved','success',4000),1200);
  setTimeout(()=>toast('📱 Emergency contact SMS sent','info',3000),2400);
  setTimeout(()=>toast('📍 Live GPS tracking started','info',3000),3600);
  startAmbulanceTracker();
}

function cancelEmergency(){
  document.getElementById('emergency-alert').classList.remove('show');
}

function startAmbulanceTracker(){
  const tracker=document.getElementById('amb-tracker-section');
  if(tracker){tracker.style.display='block';tracker.scrollIntoView({behavior:'smooth'});}
  let pos=0;
  const dot=document.querySelector('.amb-dot');
  if(dot){
    const interval=setInterval(()=>{
      pos+=2;
      dot.style.left=(20+pos*0.4)+'%';
      dot.style.top=(60-pos*0.3)+'%';
      if(pos>40){clearInterval(interval);toast('🚑 Ambulance arrived!','success',4000);}
    },200);
  }
}

function callAmbulance(){triggerEmergencyAlert('Manual Ambulance Request');}
function callNearestHospital(){toast('Calling Apollo Gleneagles Emergency: +91-33-2320-3040','info',4000);}
function notifyContact(){toast('SMS sent to emergency contact: +91-98XXX-XXXXX','success',3000);}
function shareGPS(){toast('Live GPS link sent to emergency contact','success',3000);}

// ══ APPOINTMENTS PAGE ══
let appointmentsDB=[
  {id:'A001',doctor:'Dr. Priya Sharma',spec:'General Physician',type:'Video Call',date:'2026-03-05',time:'10:30 AM',status:'upcoming',fee:250},
  {id:'A002',doctor:'Dr. Rahul Mehta',spec:'Cardiologist',type:'Physical Visit',date:'2026-02-20',time:'2:00 PM',status:'completed',fee:500},
  {id:'A003',doctor:'Dr. Sunita Rao',spec:'Pediatrician',type:'Video Call',date:'2026-02-10',time:'11:00 AM',status:'completed',fee:250},
  {id:'A004',doctor:'Dr. Aditya Kumar',spec:'Orthopedic',type:'Physical Visit',date:'2026-02-28',time:'4:30 PM',status:'cancelled',fee:500},
];

function renderAppointments(filter='all'){
  const wrap=document.getElementById('appt-list');
  if(!wrap)return;
  const list=filter==='all'?appointmentsDB:appointmentsDB.filter(a=>a.status===filter);
  if(!list.length){wrap.innerHTML=`<div class="re"><div class="rei">📅</div><p>No appointments found</p></div>`;return;}
  wrap.innerHTML=list.map(a=>{
    const d=new Date(a.date);
    const day=d.getDate();
    const mon=d.toLocaleString('default',{month:'short'}).toUpperCase();
    const typeIcon=a.type==='Video Call'?'📹':'🏥';
    return `<div class="appt-item">
      <div class="appt-date-box"><div class="appt-day">${day}</div><div class="appt-month">${mon}</div></div>
      <div class="appt-info">
        <div class="appt-doc">${a.doctor}</div>
        <div class="appt-type">${typeIcon} ${a.type} · ${a.spec}</div>
        <div class="appt-time">🕐 ${a.time} &nbsp;·&nbsp; ₹${a.fee}</div>
      </div>
      <div class="appt-actions">
        <span class="appt-badge ${a.status}">${a.status}</span>
        ${a.status==='upcoming'?`<button class="dfc-btn video" style="padding:7px 12px;font-size:8.5px" onclick="joinAppt('${a.id}')">Join</button>`:''}
      </div>
    </div>`;
  }).join('');
}

function filterAppts(tab,el){
  document.querySelectorAll('.appt-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  renderAppointments(tab);
}

function joinAppt(id){
  const a=appointmentsDB.find(x=>x.id===id);
  if(a&&a.type==='Video Call'){
    const doc=DOCTORS_DB.find(d=>d.name===a.doctor)||DOCTORS_DB[0];
    bookVideoCall(doc.id);
  } else {
    toast('Generating QR check-in code...','info',2000);
    setTimeout(()=>toast('QR Code ready — Show at clinic reception','success',3000),1500);
  }
}

function bookNewAppointment(){
  const doc=document.getElementById('appt-doctor-sel').value;
  const date=document.getElementById('appt-date').value;
  const slot=document.querySelector('.time-slot.sel');
  const type=document.getElementById('appt-type-sel').value;
  if(!doc||!date||!slot){toast('Please fill all fields and select a time slot','warning');return;}
  const newAppt={
    id:'A00'+(appointmentsDB.length+1),
    doctor:doc,spec:'General',
    type:type==='video'?'Video Call':'Physical Visit',
    date,time:slot.textContent,
    status:'upcoming',fee:type==='video'?250:500
  };
  appointmentsDB.unshift(newAppt);
  renderAppointments();
  toast('Appointment booked successfully!','success');
  addTransaction({title:`Booking — ${doc}`,type:'debit',amount:'₹'+(type==='video'?250:500),icon:'📅',date:new Date().toLocaleDateString()});
}

function selectSlot(el){
  document.querySelectorAll('.time-slot').forEach(s=>s.classList.remove('sel'));
  el.classList.add('sel');
}

// ══ BILLING PAGE ══
let walletBalance=1850;
let transactions=[
  {title:'Video Call — Dr. Priya Sharma',type:'debit',amount:'₹250',icon:'📹',date:'Feb 20, 2026'},
  {title:'Physical Visit — Dr. Rahul Mehta',type:'debit',amount:'₹500',icon:'🏥',date:'Feb 15, 2026'},
  {title:'Wallet Top-up',type:'credit',amount:'₹2000',icon:'💳',date:'Feb 10, 2026'},
  {title:'Video Call — Dr. Sunita Rao',type:'debit',amount:'₹250',icon:'📹',date:'Feb 5, 2026'},
  {title:'Referral Bonus',type:'credit',amount:'₹100',icon:'🎁',date:'Jan 30, 2026'},
];

function addTransaction(txn){
  transactions.unshift(txn);
  if(txn.type==='debit'){walletBalance-=parseInt(txn.amount.replace('₹',''));}
  renderBilling();
}

function renderBilling(){
  const bal=document.getElementById('wallet-balance');
  if(bal)bal.textContent='₹'+walletBalance.toLocaleString();
  const wrap=document.getElementById('txn-list');
  if(!wrap)return;
  wrap.innerHTML=transactions.slice(0,8).map(t=>`
    <div class="txn">
      <div class="txn-icon">${t.icon}</div>
      <div class="txn-info">
        <div class="txn-title">${t.title}</div>
        <div class="txn-date">${t.date}</div>
      </div>
      <div class="txn-amount ${t.type}">${t.type==='credit'?'+':'-'}${t.amount}</div>
    </div>
  `).join('');
}

let selectedPayMethod='upi';
function selectPayMethod(method,el){
  selectedPayMethod=method;
  document.querySelectorAll('.pay-method').forEach(m=>m.classList.remove('selected'));
  el.classList.add('selected');
  el.querySelector('.pay-check').textContent='✓';
  document.querySelectorAll('.pay-method:not(.selected) .pay-check').forEach(c=>c.textContent='');
}

function addFunds(){
  const amt=parseInt(document.getElementById('topup-amount').value)||0;
  if(amt<10){toast('Minimum top-up amount is ₹10','warning');return;}
  toast(`Processing payment of ₹${amt} via ${selectedPayMethod.toUpperCase()}...`,'info',2000);
  setTimeout(()=>{
    walletBalance+=amt;
    addTransaction({title:'Wallet Top-up',type:'credit',amount:'₹'+amt,icon:'💳',date:new Date().toLocaleDateString()});
    toast('₹'+amt+' added to wallet!','success');
  },2000);
}

// ══ ADMIN DASHBOARD ══
function initAdminDash(){
  renderAdminDoctors();
  drawRevenueChart();
}

let adminDoctors=[
  {name:'Dr. Priya Sharma',spec:'General Physician',status:'verified',earnings:'₹12,400',consults:62},
  {name:'Dr. Rahul Mehta',spec:'Cardiologist',status:'verified',earnings:'₹18,200',consults:91},
  {name:'Dr. Ankit Gupta',spec:'Dermatologist',status:'pending',earnings:'—',consults:0},
  {name:'Dr. Meera Pillai',spec:'Gynecologist',status:'pending',earnings:'—',consults:0},
];

function renderAdminDoctors(){
  const wrap=document.getElementById('admin-doctor-table');
  if(!wrap)return;
  wrap.innerHTML=adminDoctors.map((d,i)=>`
    <tr>
      <td><div style="font-family:var(--fd);font-size:10.5px">${d.name}</div><div style="font-size:11px;color:var(--txt2)">${d.spec}</div></td>
      <td><span class="badge ${d.status==='verified'?'bl':'bm'}">${d.status}</span></td>
      <td style="font-family:var(--fd);font-size:11px;color:var(--cyan)">${d.earnings}</td>
      <td>${d.consults}</td>
      <td>
        ${d.status==='pending'?`<button class="dp-btn approve" onclick="approveDoctor(${i})">Approve</button> <button class="dp-btn reject" onclick="rejectDoctor(${i})">Reject</button>`:'<span style="color:var(--green);font-size:11px">Active</span>'}
      </td>
    </tr>
  `).join('');
}

function approveDoctor(idx){
  adminDoctors[idx].status='verified';
  renderAdminDoctors();
  toast('Doctor approved and notified','success');
}
function rejectDoctor(idx){
  adminDoctors.splice(idx,1);
  renderAdminDoctors();
  toast('Doctor application rejected','info');
}

function drawRevenueChart(){
  const canvas=document.getElementById('admin-revenue-chart');
  if(!canvas||!window.Chart)return;
  if(canvas._chart)canvas._chart.destroy();
  const ctx=canvas.getContext('2d');
  canvas._chart=new Chart(ctx,{
    type:'bar',
    data:{
      labels:['Sep','Oct','Nov','Dec','Jan','Feb'],
      datasets:[
        {label:'Video Calls',data:[18000,24000,31000,28000,38000,42000],backgroundColor:'rgba(0,245,255,0.4)',borderColor:'rgba(0,245,255,0.8)',borderWidth:1},
        {label:'Physical Visits',data:[12000,16000,19000,22000,26000,31000],backgroundColor:'rgba(0,212,170,0.4)',borderColor:'rgba(0,212,170,0.8)',borderWidth:1},
        {label:'Commission',data:[3000,4000,5000,5000,6400,7300],backgroundColor:'rgba(255,140,0,0.4)',borderColor:'rgba(255,140,0,0.8)',borderWidth:1},
      ]
    },
    options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{labels:{color:'rgba(224,244,255,0.7)',font:{family:'Exo 2',size:11}}}},scales:{x:{ticks:{color:'rgba(126,184,212,0.8)'},grid:{color:'rgba(0,100,150,0.1)'}},y:{ticks:{color:'rgba(126,184,212,0.8)',callback:v=>'₹'+v.toLocaleString()},grid:{color:'rgba(0,100,150,0.1)'}}}}
  });
}

// ══ PAGE INIT HOOKS ══ (handled in patched goPage above)
</script>
</body>
</html>
